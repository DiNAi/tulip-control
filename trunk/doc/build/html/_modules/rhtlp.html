

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>rhtlp &mdash; rhtlp v0.1.0 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="rhtlp v0.1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">rhtlp v0.1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for rhtlp</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot; </span>
<span class="sd">-----------------------------------------------</span>
<span class="sd">Receding horizon Temporal Logic Planning Module</span>
<span class="sd">-----------------------------------------------</span>

<span class="sd">Nok Wongpiromsarn (nok@cds.caltech.edu)</span>

<span class="sd">:Date: August 25, 2010</span>
<span class="sd">:Version: 0.1.0</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">subprocess</span><span class="o">,</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">errorprint</span> <span class="kn">import</span> <span class="n">printWarning</span><span class="p">,</span> <span class="n">printError</span><span class="p">,</span> <span class="n">printInfo</span>
<span class="kn">from</span> <span class="nn">parsespec</span> <span class="kn">import</span> <span class="n">parseSpec</span>
<span class="kn">from</span> <span class="nn">polytope_computations</span> <span class="kn">import</span> <span class="n">Polytope</span><span class="p">,</span> <span class="n">Region</span>
<span class="kn">from</span> <span class="nn">discretizeM</span> <span class="kn">import</span> <span class="n">CtsSysDyn</span><span class="p">,</span> <span class="n">discretizeM</span>
<span class="kn">from</span> <span class="nn">prop2part</span> <span class="kn">import</span> <span class="n">PropPreservingPartition</span><span class="p">,</span> <span class="n">prop2part2</span>
<span class="kn">from</span> <span class="nn">automaton</span> <span class="kn">import</span> <span class="n">Automaton</span>
<span class="kn">from</span> <span class="nn">spec</span> <span class="kn">import</span> <span class="n">GRSpec</span>
<span class="kn">import</span> <span class="nn">rhtlputil</span>
<span class="kn">import</span> <span class="nn">grgameint</span>


<div class="viewcode-block" id="SynthesisProb"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb">[docs]</a><span class="k">class</span> <span class="nc">SynthesisProb</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SynthesisProb class for specifying a planner synthesis problem.</span>
<span class="sd">    A SynthesisProb object contains the following fields:</span>

<span class="sd">    - `env_vars`: a dictionary {str : str} whose keys are the names </span>
<span class="sd">      of environment variables and whose values are their possible values, e.g., </span>
<span class="sd">      boolean or {0, 2, 3, 4, 5}.</span>
<span class="sd">    - `sys_vars`: a dictionary {str : str} whose keys are the </span>
<span class="sd">      names of system variables and whose values are their possible values.</span>
<span class="sd">    - `spec`: a GRSpec object that specifies the specification of this synthesis problem.</span>
<span class="sd">    - `disc_cont_var`: the name of the continuous variable after the discretization.</span>
<span class="sd">    - `disc_dynamics`: a list of Region objects corresponding to the partition of the</span>
<span class="sd">      continuous state space.</span>

<span class="sd">    **Constructor**:</span>

<span class="sd">    **SynthesisProb** ([ `file` = &#39;&#39;[, `verbose` = 0]]): </span>
<span class="sd">    construct this SynthesisProb object from file</span>

<span class="sd">    - `file`: the name of the rhtlp file to be parsed. If `file` is given,</span>
<span class="sd">      the rest of the inputs to this function will be ignored.</span>

<span class="sd">    **SynthesisProb** ([ `env_vars` = {}[, `sys_disc_vars` = {}[, `disc_props` = {}[, </span>
<span class="sd">    `disc_dynamics` = None[, `spec` = GRSpec()[, `verbose` = 0]]]]]])</span>

<span class="sd">    **SynthesisProb** ([ `env_vars` = {}[, `sys_disc_vars` = {}[, `disc_props` = {}[, </span>
<span class="sd">    `cont_state_space` = None[, `cont_props` = {}[, `sys_dyn` = None[, </span>
<span class="sd">    `spec` = GRSpec()[, `verbose` = 0]]]]]]]])</span>

<span class="sd">    - `env_vars`: a dictionary {str : str} or {str : list} whose keys are the names </span>
<span class="sd">      of environment variables and whose values are their possible values, e.g., </span>
<span class="sd">      boolean or {0, 2, ..., 5} or [0, 2, 3, 4, 5].</span>
<span class="sd">    - `sys_disc_vars`: a dictionary {str : str} or {str : list} whose keys are the </span>
<span class="sd">      names of discrete system variables and whose values are their possible values.</span>
<span class="sd">    - `disc_props`: a dictionary {str : str} whose keys are the symbols for </span>
<span class="sd">      propositions on discrete variables and whose values are the actual propositions</span>
<span class="sd">      on discrete variables.</span>
<span class="sd">    - `disc_dynamics`: a PropPreservingPartition object that represents the </span>
<span class="sd">      transition system obtained from the discretization procedure.</span>
<span class="sd">      if `disc_dynamics` is given, `cont_state_space`, `cont_props` and `sys_dyn`</span>
<span class="sd">      will be ignored.</span>
<span class="sd">    - `cont_state_space`: a Polytope object that represent the state space of the</span>
<span class="sd">      continuous variables</span>
<span class="sd">    - `cont_props`: a dictionary {str : Polytope} whose keys are the symbols for </span>
<span class="sd">      propositions on continuous variables and whose values are polytopes that represent</span>
<span class="sd">      the region in the state space in which the corresponding proposition hold.</span>
<span class="sd">    - `sys_dyn`: a CtsSysDyn object that specifies the dynamics of the continuous variables</span>
<span class="sd">    - `spec`: a GRSpec object that specifies the specification of this synthesis problem</span>
<span class="sd">    - `verbose`: an integer that specifies the level of verbosity.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__env_vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sys_vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span> <span class="o">=</span> <span class="n">GRSpec</span><span class="p">(</span><span class="n">env_init</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">sys_init</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">env_safety</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">sys_safety</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> \
                               <span class="n">env_prog</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">sys_prog</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__disc_cont_var</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__disc_dynamics</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__jtlvfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span> \
                                           <span class="s">&#39;tmpspec&#39;</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__realizable</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">verbose</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;verbose&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">env_vars</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;env_vars&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">sys_disc_vars</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sys_disc_vars&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">disc_props</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;disc_props&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">spec</span> <span class="o">=</span> <span class="n">GRSpec</span><span class="p">(</span><span class="n">env_init</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">sys_init</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">env_safety</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">sys_safety</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> \
                               <span class="n">env_prog</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">sys_prog</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;spec&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s">&#39;spec&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;file&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">]</span>
            <span class="c"># Check that the input is valid</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input file is expected to be a string&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid file.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="nb">file</span><span class="p">)):</span>
                <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The rhtlp file &quot;</span> <span class="o">+</span> <span class="nb">file</span> <span class="o">+</span> <span class="s">&quot; does not exist.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid file.&quot;</span><span class="p">)</span>

            <span class="p">(</span><span class="n">env_vars</span><span class="p">,</span> <span class="n">sys_disc_vars</span><span class="p">,</span> <span class="n">disc_props</span><span class="p">,</span> <span class="n">sys_cont_vars</span><span class="p">,</span> <span class="n">cont_state_space</span><span class="p">,</span> \
                 <span class="n">cont_props</span><span class="p">,</span> <span class="n">sys_dyn</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span> <span class="o">=</span> <span class="n">parseSpec</span><span class="p">(</span><span class="n">spec_file</span><span class="o">=</span><span class="nb">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createProbFromContDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> \
                                            <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                            <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                            <span class="n">cont_state_space</span><span class="o">=</span><span class="n">cont_state_space</span><span class="p">,</span> \
                                            <span class="n">cont_props</span><span class="o">=</span><span class="n">cont_props</span><span class="p">,</span> \
                                            <span class="n">sys_dyn</span><span class="o">=</span><span class="n">sys_dyn</span><span class="p">,</span> 
                                            <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> \
                                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="s">&#39;disc_dynamics&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">disc_dynamics</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s">&#39;disc_dynamics&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createProbFromDiscDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> \
                                            <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                            <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                            <span class="n">disc_dynamics</span><span class="o">=</span><span class="n">disc_dynamics</span><span class="p">,</span> \
                                            <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> \
                                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>       
            <span class="n">cont_state_space</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cont_state_space&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">cont_props</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cont_props&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">sys_dyn</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sys_dyn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createProbFromContDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> \
                                            <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                            <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                            <span class="n">cont_state_space</span><span class="o">=</span><span class="n">cont_state_space</span><span class="p">,</span> \
                                            <span class="n">cont_props</span><span class="o">=</span><span class="n">cont_props</span><span class="p">,</span> \
                                            <span class="n">sys_dyn</span><span class="o">=</span><span class="n">sys_dyn</span><span class="p">,</span> 
                                            <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> \
                                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c">###################################################################</span>

<div class="viewcode-block" id="SynthesisProb.getEnvVars"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.getEnvVars">[docs]</a>    <span class="k">def</span> <span class="nf">getEnvVars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the environment variables of this object as a dictionary </span>
<span class="sd">        whose key is the name of the variable</span>
<span class="sd">        and whose value is the possible values that the variable can take.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__env_vars</span><span class="p">)</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.setEnvVars"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.setEnvVars">[docs]</a>    <span class="k">def</span> <span class="nf">setEnvVars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_vars</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the environment variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sys_disc_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSysDiscVars</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createProbFromDiscDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> \
                                            <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                            <span class="n">disc_props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span><span class="p">,</span> \
                                            <span class="n">disc_dynamics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_dynamics</span><span class="p">,</span> \
                                            <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">,</span> \
                                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.getSysDiscVars"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.getSysDiscVars">[docs]</a>    <span class="k">def</span> <span class="nf">getSysDiscVars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the system discrete variables of </span>
<span class="sd">        this object as a dictionary whose key is the name of the variable</span>
<span class="sd">        and whose value is the possible values that the variable can take.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sys_disc_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSysVars</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span> <span class="ow">in</span> <span class="n">sys_disc_vars</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">sys_disc_vars</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">sys_disc_vars</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.setSysDiscVars"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.setSysDiscVars">[docs]</a>    <span class="k">def</span> <span class="nf">setSysDiscVars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sys_disc_vars</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the system discrete variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createProbFromDiscDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__env_vars</span><span class="p">,</span> \
                                            <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                            <span class="n">disc_props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span><span class="p">,</span> \
                                            <span class="n">disc_dynamics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_dynamics</span><span class="p">,</span> \
                                            <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">,</span> \
                                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.getSysVars"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.getSysVars">[docs]</a>    <span class="k">def</span> <span class="nf">getSysVars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the system (discrete and discretized continuous) variables of </span>
<span class="sd">        this object as a dictionary whose key is the name of the variable</span>
<span class="sd">        and whose value is the possible values that the variable can take.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__sys_vars</span><span class="p">)</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.getDiscProps"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.getDiscProps">[docs]</a>    <span class="k">def</span> <span class="nf">getDiscProps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the discrete propositions as a dictionary whose key is the </span>
<span class="sd">        symbol of the proposition and whose value is the actual formula of</span>
<span class="sd">        the proposition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span><span class="p">)</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.setDiscProps"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.setDiscProps">[docs]</a>    <span class="k">def</span> <span class="nf">setDiscProps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disc_props</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the propositions on discrete variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sys_disc_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSysVars</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createProbFromDiscDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__env_vars</span><span class="p">,</span> \
                                            <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                            <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                            <span class="n">disc_dynamics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_dynamics</span><span class="p">,</span> \
                                            <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">,</span> \
                                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.getSpec"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.getSpec">[docs]</a>    <span class="k">def</span> <span class="nf">getSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the specification of this object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">)</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.setSpec"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.setSpec">[docs]</a>    <span class="k">def</span> <span class="nf">setSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the specification.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sys_disc_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSysVars</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createProbFromDiscDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__env_vars</span><span class="p">,</span> \
                                            <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                            <span class="n">disc_props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span><span class="p">,</span> \
                                            <span class="n">disc_dynamics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_dynamics</span><span class="p">,</span> \
                                            <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> \
                                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.getDiscretizedContVar"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.getDiscretizedContVar">[docs]</a>    <span class="k">def</span> <span class="nf">getDiscretizedContVar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the name of the discretized continuous variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__disc_cont_var</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.getDiscretizedDynamics"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.getDiscretizedDynamics">[docs]</a>    <span class="k">def</span> <span class="nf">getDiscretizedDynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the discretized dynamics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__disc_dynamics</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.setDiscretizedDynamics"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.setDiscretizedDynamics">[docs]</a>    <span class="k">def</span> <span class="nf">setDiscretizedDynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disc_dynamics</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the discretized dynamics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sys_disc_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSysVars</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createProbFromDiscDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__env_vars</span><span class="p">,</span> \
                                            <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                            <span class="n">disc_props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span><span class="p">,</span> \
                                            <span class="n">disc_dynamics</span><span class="o">=</span><span class="n">disc_dynamics</span><span class="p">,</span> \
                                            <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">,</span> \
                                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.getJTLVFile"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.getJTLVFile">[docs]</a>    <span class="k">def</span> <span class="nf">getJTLVFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the name of JTLV files. The smv, spc and aut files are appended</span>
<span class="sd">        by .smv, .spc and .aut, respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__jtlvfile</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.setJTLVFile"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.setJTLVFile">[docs]</a>    <span class="k">def</span> <span class="nf">setJTLVFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jtlvfile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the temporary jtlv files (smv, spc, aut).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">jtlvfile</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__jtlvfile</span> <span class="o">=</span> <span class="n">jtlvfile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__realizable</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&#39;The input jtlvfile must be a string indicating the name of the file.&#39;</span><span class="p">,</span> \
                           <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>


    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.createProbFromContDynamics"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.createProbFromContDynamics">[docs]</a>    <span class="k">def</span> <span class="nf">createProbFromContDynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_vars</span><span class="o">=</span><span class="p">{},</span> <span class="n">sys_disc_vars</span><span class="o">=</span><span class="p">{},</span> <span class="n">disc_props</span><span class="o">=</span><span class="p">{},</span> \
                                       <span class="n">cont_state_space</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cont_props</span><span class="o">=</span><span class="p">{},</span> <span class="n">sys_dyn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> \
                                       <span class="n">spec</span><span class="o">=</span><span class="n">GRSpec</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct SynthesisProb from continuous dynamics.</span>

<span class="sd">        Input:</span>

<span class="sd">        - `env_vars`: a dictionary {str : str} or {str : list} whose keys are the names </span>
<span class="sd">          of environment variables and whose values are their possible values, e.g., </span>
<span class="sd">          boolean or {0, 2, ..., 5} or [0, 2, 3, 4, 5].</span>
<span class="sd">        - `sys_disc_vars`: a dictionary {str : str} or {str : list} whose keys are the </span>
<span class="sd">          names of discrete system variables and whose values are their possible values.</span>
<span class="sd">        - `disc_props`: a dictionary {str : str} whose keys are the symbols for </span>
<span class="sd">          propositions on discrete variables and whose values are the actual propositions</span>
<span class="sd">          on discrete variables.</span>
<span class="sd">        - `cont_state_space`: a Polytope object that represent the state space of the</span>
<span class="sd">          continuous variables</span>
<span class="sd">        - `cont_props`: a dictionary {str : Polytope} whose keys are the symbols for </span>
<span class="sd">          propositions on continuous variables and whose values are polytopes that represent</span>
<span class="sd">          the region in the state space in which the corresponding proposition hold.</span>
<span class="sd">        - `sys_dyn`: a CtsSysDyn object that specifies the dynamics of the continuous variables</span>
<span class="sd">        - `spec`: a GRSpec object that specifies the specification of this synthesis problem.</span>
<span class="sd">        - `verbose`: an integer that specifies the level of verbosity.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cont_state_space</span><span class="p">,</span> <span class="n">Polytope</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="n">cont_state_space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The type of input cont_state_space is expected to be &quot;</span> <span class="o">+</span> \
                           <span class="s">&quot;Polytope&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid cont_state_space.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cont_props</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cont_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input cont_props is expected to be a dictionary &quot;</span> <span class="o">+</span> \
                           <span class="s">&quot;{str : Polytope}&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid disc_props.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sys_dyn</span><span class="p">,</span> <span class="n">CtsSysDyn</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sys_dyn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The type of input sys_dyn is expected to be CtsSysDyn&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid sys_dyn.&quot;</span><span class="p">)</span>

        <span class="c"># Process the continuous component</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cont_state_space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cont_props</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">cont_props</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cont_partition</span> <span class="o">=</span> <span class="n">prop2part2</span><span class="p">(</span><span class="n">cont_state_space</span><span class="p">,</span> <span class="n">cont_props</span><span class="p">)</span>
            <span class="n">disc_dynamics</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cont_partition</span><span class="p">)</span>
            <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">trans</span> <span class="o">=</span> <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">adj</span>
            <span class="k">for</span> <span class="n">fromcell</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">trans</span><span class="p">)):</span>
                <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="n">fromcell</span><span class="p">][</span><span class="n">fromcell</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sys_dyn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">disc_dynamics</span> <span class="o">=</span> <span class="n">discretizeM</span><span class="p">(</span><span class="n">cont_partition</span><span class="p">,</span> <span class="n">sys_dyn</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;No continuous component&quot;</span><span class="p">)</span>
            <span class="n">disc_dynamics</span> <span class="o">=</span> <span class="n">PropPreservingPartition</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">num_prop</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> \
                                                        <span class="n">list_region</span><span class="o">=</span><span class="p">[],</span> <span class="n">num_regions</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> \
                                                        <span class="n">adj</span><span class="o">=</span><span class="p">[],</span> <span class="n">trans</span><span class="o">=</span><span class="p">[],</span> \
                                                        <span class="n">list_prop_symbol</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createProbFromDiscDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> \
                                            <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                            <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                            <span class="n">disc_dynamics</span><span class="o">=</span><span class="n">disc_dynamics</span><span class="p">,</span> \
                                            <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> \
                                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.createProbFromDiscDynamics"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.createProbFromDiscDynamics">[docs]</a>    <span class="k">def</span> <span class="nf">createProbFromDiscDynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_vars</span><span class="o">=</span><span class="p">{},</span> <span class="n">sys_disc_vars</span><span class="o">=</span><span class="p">{},</span> \
                       <span class="n">disc_props</span><span class="o">=</span><span class="p">{},</span> <span class="n">disc_dynamics</span><span class="o">=</span><span class="n">PropPreservingPartition</span><span class="p">(),</span> \
                       <span class="n">spec</span><span class="o">=</span><span class="n">GRSpec</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct SynthesisProb from discretized continuous dynamics.</span>

<span class="sd">        Input:</span>
<span class="sd">        </span>
<span class="sd">        - `env_vars`: a dictionary {str : str} or {str : list} whose keys are the names </span>
<span class="sd">          of environment variables and whose values are their possible values, e.g., </span>
<span class="sd">          boolean or {0, 2, ..., 5} or [0, 2, 3, 4, 5].</span>
<span class="sd">        - `sys_disc_vars`: a dictionary {str : str} or {str : list} whose keys are the </span>
<span class="sd">          names of discrete system variables and whose values are their possible values.</span>
<span class="sd">        - `disc_props`: a dictionary {str : str} whose keys are the symbols for </span>
<span class="sd">          propositions on discrete variables and whose values are the actual propositions</span>
<span class="sd">          on discrete variables.</span>
<span class="sd">        - `disc_dynamics`: a PropPreservingPartition object that represents the </span>
<span class="sd">          transition system obtained from the discretization procedure.</span>
<span class="sd">        - `spec`: a GRSpec object that specifies the specification of this synthesis problem.</span>
<span class="sd">        - `verbose`: an integer that specifies the level of verbosity.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Check that the input is valid</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">env_vars</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">env_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input env_vars is expected to be a dictionary &quot;</span> <span class="o">+</span> \
                           <span class="s">&quot;{str : str} or {str : list}.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid env_vars.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sys_disc_vars</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sys_disc_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input sys_disc_vars is expected to be a dictionary &quot;</span> <span class="o">+</span> \
                           <span class="s">&quot;{str : str} or {str : list}&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid sys_disc_vars.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">disc_props</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">disc_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input disc_props is expected to be a dictionary &quot;</span> <span class="o">+</span> \
                           <span class="s">&quot;{str : str}&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid disc_props.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">disc_dynamics</span><span class="p">,</span> <span class="n">PropPreservingPartition</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="n">disc_dynamics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The type of input disc_dynamics is expected to be &quot;</span> <span class="o">+</span> \
                           <span class="s">&quot;PropPreservingPartition&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid disc_dynamics.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">GRSpec</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input spec is expected to be a GRSpec object&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid spec.&quot;</span><span class="p">)</span>            

        <span class="c"># Check that the number of regions in disc_dynamics is correct.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">disc_dynamics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_region</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_region</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">num_regions</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_region</span><span class="p">)):</span>
                <span class="n">printWarning</span><span class="p">(</span><span class="s">&#39;disc_dynamics.num_regions != &#39;</span> <span class="o">+</span> \
                                 <span class="s">&#39;len(disc_dynamics.list_regions)&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">num_regions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_region</span><span class="p">)</span>

        <span class="c"># Construct this object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__env_vars</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">env_vars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sys_vars</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">sys_disc_vars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">disc_props</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__realizable</span> <span class="o">=</span> <span class="bp">None</span>
<span class="c">#         self.__jtlvfile = os.path.join(os.path.abspath(os.path.dirname(__file__)), \</span>
<span class="c">#                                            &#39;tmpspec&#39;, &#39;tmp&#39;)</span>

        <span class="c"># Replace &#39;...&#39; in the range of possible values of env_vars to the actual  </span>
        <span class="c"># values and convert a list representation of the range of possible values </span>
        <span class="c"># to a string</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">env_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">env_vars</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="s">&#39;boolean&#39;</span> <span class="ow">in</span> <span class="n">reg</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                    <span class="n">all_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;[-+]?\d+&#39;</span><span class="p">,</span> <span class="n">reg</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">dots_values</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;([-+]?\d+)\s*,?\s*&#39;</span> <span class="o">+</span> <span class="s">r&#39;\.\.\.&#39;</span> <span class="o">+</span> \
                                                     <span class="s">&#39;\s*,?\s*([-+]?\d+)&#39;</span><span class="p">,</span> <span class="n">reg</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">dots_pair</span> <span class="ow">in</span> <span class="n">dots_values</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dots_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dots_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">):</span>
                                    <span class="n">all_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
                        <span class="n">reg</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="n">reg</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span>
                            <span class="n">reg</span> <span class="o">+=</span> <span class="n">val</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__env_vars</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;{&#39;</span> <span class="o">+</span> <span class="n">reg</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">printWarning</span><span class="p">(</span><span class="s">&quot;Unknown possible values for environment &quot;</span> <span class="o">+</span> \
                                         <span class="s">&quot;variable &quot;</span> <span class="o">+</span> <span class="n">var</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                    <span class="n">all_values</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">reg</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="n">all_values</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span>
                        <span class="n">all_values</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__env_vars</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;{&#39;</span> <span class="o">+</span> <span class="n">all_values</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">printWarning</span><span class="p">(</span><span class="s">&quot;Unknown possible values for environment &quot;</span> <span class="o">+</span> \
                                     <span class="s">&quot;variable &quot;</span><span class="o">+</span> <span class="n">var</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Replace &#39;...&#39; in the range of possible values of sys_disc_vars to the actual </span>
        <span class="c"># values and convert a list representation of the range of possible values to a </span>
        <span class="c"># string</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sys_disc_vars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">sys_disc_vars</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="s">&#39;boolean&#39;</span> <span class="ow">in</span> <span class="n">reg</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                    <span class="n">all_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;[-+]?\d+&#39;</span><span class="p">,</span> <span class="n">reg</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">dots_values</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;([-+]?\d+)\s*,?\s*&#39;</span> <span class="o">+</span> <span class="s">r&#39;\.\.\.&#39;</span> <span class="o">+</span> \
                                                     <span class="s">&#39;\s*,?\s*([-+]?\d+)&#39;</span><span class="p">,</span> <span class="n">reg</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">dots_pair</span> <span class="ow">in</span> <span class="n">dots_values</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dots_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dots_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">):</span>
                                    <span class="n">all_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
                        <span class="n">reg</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="n">reg</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span>
                            <span class="n">reg</span> <span class="o">+=</span> <span class="n">val</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__sys_vars</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;{&#39;</span> <span class="o">+</span> <span class="n">reg</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">printWarning</span><span class="p">(</span><span class="s">&quot;Unknown possible values for discrete &quot;</span> <span class="o">+</span> \
                                         <span class="s">&quot;system variable &quot;</span> <span class="o">+</span> <span class="n">var</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                    <span class="n">all_values</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">reg</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="n">all_values</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span>
                        <span class="n">all_values</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sys_vars</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;{&#39;</span> <span class="o">+</span> <span class="n">all_values</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">printWarning</span><span class="p">(</span><span class="s">&quot;Unknown possible values for discrete system &quot;</span> <span class="o">+</span> \
                                     <span class="s">&quot;variable &quot;</span> <span class="o">+</span> <span class="n">var</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># New variable that identifies in which cell the continuous state is</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__disc_cont_var</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__disc_dynamics</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">cont_varname</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">disc_dynamics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">num_regions</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">cont_varname</span> <span class="o">=</span> <span class="s">&#39;cellID&#39;</span> 

            <span class="c"># Make sure that the new variable name does not appear in env_vars </span>
            <span class="c"># or sys_disc_vars</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">cont_varname</span> <span class="ow">in</span> <span class="n">env_vars</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cont_varname</span> <span class="ow">in</span> <span class="n">sys_disc_vars</span><span class="p">):</span>
                <span class="n">cont_varname</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span> <span class="o">+</span> <span class="n">cont_varname</span>

            <span class="n">contvar_values</span> <span class="o">=</span> <span class="s">&#39;{&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">num_regions</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">contvar_values</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">contvar_values</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">contvar_values</span> <span class="o">+=</span> <span class="s">&#39;}&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sys_vars</span><span class="p">[</span><span class="n">cont_varname</span><span class="p">]</span> <span class="o">=</span> <span class="n">contvar_values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__disc_cont_var</span> <span class="o">=</span> <span class="n">cont_varname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__disc_dynamics</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">disc_dynamics</span><span class="p">)</span>

        <span class="c"># Process the spec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

        <span class="c"># Replace any cont_prop XC by (s.p = P1) | (s.p = P2) | ... | (s.p = Pn) where </span>
        <span class="c"># P1, ..., Pn are cells in disc_dynamics that satisfy XC</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">disc_dynamics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_prop_symbol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">propInd</span><span class="p">,</span> <span class="n">propSymbol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_prop_symbol</span><span class="p">):</span>
                <span class="n">reg</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">num_regions</span><span class="p">)</span> <span class="k">if</span> \
                           <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_region</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">list_prop</span><span class="p">[</span><span class="n">propInd</span><span class="p">]]</span>
                <span class="n">newprop</span> <span class="o">=</span> <span class="s">&#39;FALSE&#39;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">newprop</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">regID</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reg</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="n">newprop</span> <span class="o">=</span> <span class="n">newprop</span> <span class="o">+</span> <span class="s">&#39; | &#39;</span>
                        <span class="n">newprop</span> <span class="o">=</span> <span class="n">newprop</span> <span class="o">+</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">cont_varname</span> <span class="o">+</span> <span class="s">&#39; = &#39;</span> <span class="o">+</span> \
                            <span class="nb">str</span><span class="p">(</span><span class="n">regID</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">,</span> <span class="n">GRSpec</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="o">.</span><span class="n">sym2prop</span><span class="p">(</span><span class="n">props</span><span class="o">=</span><span class="p">{</span><span class="n">propSymbol</span><span class="p">:</span><span class="n">newprop</span><span class="p">},</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="n">propSymbol</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;(&#39;</span><span class="o">+</span><span class="n">newprop</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">,</span> \
                                                <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="n">propSymbol</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;(&#39;</span><span class="o">+</span><span class="n">newprop</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">,</span> \
                                                <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c"># Replace symbols for propositions on discrete variables with the actual </span>
        <span class="c"># propositions</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">,</span> <span class="n">GRSpec</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="o">.</span><span class="n">sym2prop</span><span class="p">(</span><span class="n">props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">disc_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">propSymbol</span><span class="p">,</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">disc_props</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">propSymbol</span> <span class="o">+</span> <span class="s">&#39; -&gt; &#39;</span> <span class="o">+</span> <span class="n">prop</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="n">propSymbol</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;(&#39;</span><span class="o">+</span><span class="n">prop</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="n">propSymbol</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;(&#39;</span><span class="o">+</span><span class="n">prop</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c">#         # Transitions for continuous dynamics</span>
<span class="c">#         addAnd = False</span>
<span class="c">#         if (len(self.__spec.sys_safety) &gt; 0 and not(self.__spec.sys_safety.isspace())):</span>
<span class="c">#             addAnd = True</span>
<span class="c">#</span>
<span class="c">#         if (disc_dynamics is not None):</span>
<span class="c">#             for from_region in xrange(0,disc_dynamics.num_regions):</span>
<span class="c">#                 to_regions = [j for j in range(0,disc_dynamics.num_regions) if \</span>
<span class="c">#                                   disc_dynamics.trans[j][from_region]]</span>
<span class="c">#                 if (addAnd):</span>
<span class="c">#                     self.__spec.sys_safety += &#39; &amp;\n&#39;</span>
<span class="c">#                 if (from_region == 0):</span>
<span class="c">#                     self.__spec.sys_safety += &#39;-- transition relations for continuous dynamics\n&#39;</span>
<span class="c">#                 self.__spec.sys_safety += &#39;\t((&#39; + cont_varname + &#39; = &#39; + \</span>
<span class="c">#                                   str(from_region) + &#39;) -&gt; next(&#39;</span>
<span class="c">#                 if (len(to_regions) == 0):</span>
<span class="c">#                     self.__spec.sys_safety += &#39;FALSE&#39;</span>
<span class="c">#                 for i, to_region in enumerate(to_regions):</span>
<span class="c">#                     if (i &gt; 0):</span>
<span class="c">#                         self.__spec.sys_safety += &#39; | &#39;</span>
<span class="c">#                     self.__spec.sys_safety += &#39;(&#39; + cont_varname + &#39; = &#39; + str(to_region) + &#39;)&#39;</span>
<span class="c">#                 self.__spec.sys_safety += &#39;))&#39;</span>
<span class="c">#                 addAnd = True</span>


    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.checkRealizability"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.checkRealizability">[docs]</a>    <span class="k">def</span> <span class="nf">checkRealizability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heap_size</span><span class="o">=</span><span class="s">&#39;-Xmx128m&#39;</span><span class="p">,</span> <span class="n">pick_sys_init</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine whether this SynthesisProb is realizable without </span>
<span class="sd">        extracting an automaton.</span>

<span class="sd">        Input:</span>

<span class="sd">        - `heap_size`: a string that specifies java heap size. </span>
<span class="sd">        - `pick_sys_init` is a boolean indicating whether the system can pick </span>
<span class="sd">          its initial state (in response to the initial environment state).</span>
<span class="sd">        - `verbose`: an integer that specifies the level of verbosity.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">smv_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__jtlvfile</span> <span class="o">+</span> <span class="s">&#39;.smv&#39;</span>
        <span class="n">spc_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__jtlvfile</span> <span class="o">+</span> <span class="s">&#39;.spc&#39;</span>
        <span class="n">aut_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__jtlvfile</span> <span class="o">+</span> <span class="s">&#39;.aut&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toJTLVInput</span><span class="p">(</span><span class="n">smv_file</span><span class="o">=</span><span class="n">smv_file</span><span class="p">,</span> <span class="n">spc_file</span><span class="o">=</span><span class="n">spc_file</span><span class="p">,</span> \
                          <span class="n">file_exist_option</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">init_option</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pick_sys_init</span><span class="p">):</span>
            <span class="n">init_option</span> <span class="o">=</span> <span class="mi">0</span>

            
        <span class="n">realizable</span> <span class="o">=</span> <span class="n">grgameint</span><span class="o">.</span><span class="n">solveGame</span><span class="p">(</span><span class="n">smv_file</span><span class="o">=</span><span class="n">smv_file</span><span class="p">,</span> <span class="n">spc_file</span><span class="o">=</span><span class="n">spc_file</span><span class="p">,</span> \
                                         <span class="n">aut_file</span><span class="o">=</span><span class="n">aut_file</span><span class="p">,</span> \
                                         <span class="n">heap_size</span><span class="o">=</span><span class="n">heap_size</span><span class="p">,</span> \
                                         <span class="n">priority_kind</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> \
                                         <span class="n">init_option</span><span class="o">=</span><span class="n">init_option</span><span class="p">,</span> \
                                         <span class="n">file_exist_option</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__realizable</span> <span class="o">=</span> <span class="n">realizable</span>
        <span class="k">return</span> <span class="n">realizable</span>

    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.getCounterExamples"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.getCounterExamples">[docs]</a>    <span class="k">def</span> <span class="nf">getCounterExamples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recompute</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">heap_size</span><span class="o">=</span><span class="s">&#39;-Xmx128m&#39;</span><span class="p">,</span> \
                               <span class="n">pick_sys_init</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of dictionary representing a state starting from</span>
<span class="sd">        which the system cannot satisfy the spec.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">recompute</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__realizable</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__realizable</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;Checking realizability&quot;</span>
            <span class="n">realizable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkRealizability</span><span class="p">(</span><span class="n">heap_size</span><span class="o">=</span><span class="n">heap_size</span><span class="p">,</span> \
                                                     <span class="n">pick_sys_init</span><span class="o">=</span><span class="n">pick_sys_init</span><span class="p">,</span> \
                                                     <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__realizable</span> <span class="o">=</span> <span class="n">realizable</span>
        <span class="n">ce</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__realizable</span><span class="p">):</span>
            <span class="n">aut_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__jtlvfile</span> <span class="o">+</span> <span class="s">&#39;.aut&#39;</span>
            <span class="n">ce</span> <span class="o">=</span> <span class="n">grgameint</span><span class="o">.</span><span class="n">getCounterExamples</span><span class="p">(</span><span class="n">aut_file</span><span class="o">=</span><span class="n">aut_file</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>        
        <span class="k">return</span> <span class="n">ce</span>


    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.synthesizePlannerAut"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.synthesizePlannerAut">[docs]</a>    <span class="k">def</span> <span class="nf">synthesizePlannerAut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heap_size</span><span class="o">=</span><span class="s">&#39;-Xmx128m&#39;</span><span class="p">,</span> <span class="n">priority_kind</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">init_option</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> \
                                 <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute a planner automaton for this SynthesisProb. </span>
<span class="sd">        If this SynthesisProb is realizable, this function returns an Automaton object.</span>
<span class="sd">        Otherwise, it returns a list of dictionary that represents the state</span>
<span class="sd">        starting from which there exists no strategy for the system to satisfy the spec.</span>

<span class="sd">        Input:</span>

<span class="sd">        - `heap_size`: a string that specifies java heap size. </span>
<span class="sd">        - `priority_kind`: a string of length 3 or an integer that specifies the type of </span>
<span class="sd">          priority used in extracting the automaton. See the documentation of the </span>
<span class="sd">          ``computeStrategy`` function for the possible values of `priority_kind`.</span>
<span class="sd">        - `init_option`: an integer in that specifies how to handle the initial state of </span>
<span class="sd">          the system. See the documentation of the ``computeStrategy`` function for the </span>
<span class="sd">          possible values of `init_option`.</span>
<span class="sd">        - `verbose`: an integer that specifies the level of verbosity. If verbose is set to 0,</span>
<span class="sd">          this function will not print anything on the screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">smv_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__jtlvfile</span> <span class="o">+</span> <span class="s">&#39;.smv&#39;</span>
        <span class="n">spc_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__jtlvfile</span> <span class="o">+</span> <span class="s">&#39;.spc&#39;</span>
        <span class="n">aut_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__jtlvfile</span> <span class="o">+</span> <span class="s">&#39;.aut&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toJTLVInput</span><span class="p">(</span><span class="n">smv_file</span><span class="o">=</span><span class="n">smv_file</span><span class="p">,</span> <span class="n">spc_file</span><span class="o">=</span><span class="n">spc_file</span><span class="p">,</span> \
                          <span class="n">file_exist_option</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">realizable</span> <span class="o">=</span> <span class="n">grgameint</span><span class="o">.</span><span class="n">solveGame</span><span class="p">(</span><span class="n">smv_file</span><span class="o">=</span><span class="n">smv_file</span><span class="p">,</span> <span class="n">spc_file</span><span class="o">=</span><span class="n">spc_file</span><span class="p">,</span> \
                                         <span class="n">aut_file</span><span class="o">=</span><span class="n">aut_file</span><span class="p">,</span> \
                                         <span class="n">heap_size</span><span class="o">=</span><span class="n">heap_size</span><span class="p">,</span> \
                                         <span class="n">priority_kind</span><span class="o">=</span><span class="n">priority_kind</span><span class="p">,</span> \
                                         <span class="n">init_option</span><span class="o">=</span><span class="n">init_option</span><span class="p">,</span> \
                                         <span class="n">file_exist_option</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__realizable</span> <span class="o">=</span> <span class="n">realizable</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">realizable</span><span class="p">):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&#39;spec not realizable&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">counter_examples</span> <span class="o">=</span> <span class="n">grgameint</span><span class="o">.</span><span class="n">getCounterExamples</span><span class="p">(</span><span class="n">aut_file</span><span class="o">=</span><span class="n">aut_file</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">counter_examples</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aut</span> <span class="o">=</span> <span class="n">Automaton</span><span class="p">(</span><span class="n">states_or_file</span><span class="o">=</span><span class="n">aut_file</span><span class="p">,</span> <span class="n">varnames</span><span class="o">=</span><span class="p">[],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">aut</span>


    <span class="c">###################################################################</span>
</div>
<div class="viewcode-block" id="SynthesisProb.toJTLVInput"><a class="viewcode-back" href="../rhtlp.html#rhtlp.SynthesisProb.toJTLVInput">[docs]</a>    <span class="k">def</span> <span class="nf">toJTLVInput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">smv_file</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">spc_file</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">file_exist_option</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate JTLV input files: smv_file and spc_file for this SynthesisProb.</span>

<span class="sd">        Input:</span>

<span class="sd">        - `smv_file`: a string that specifies the name of the resulting smv file.</span>
<span class="sd">        - `spc_file`: a string that specifies the name of the resulting spc file.</span>
<span class="sd">        - `file_exist_option`: a string that indicate what to do when the specified smv_file </span>
<span class="sd">          or spc_file exists. Possible values are: &#39;a&#39; (ask whether to replace or</span>
<span class="sd">          create a new file), &#39;r&#39; (replace the existing file), &#39;n&#39; (create a new file).</span>
<span class="sd">        - `verbose`: an integer that specifies the level of verbosity. If verbose is set to 0,</span>
<span class="sd">          this function will not print anything on the screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Check that the input is valid</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smv_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input smv_file is expected to be a string&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid smv_file.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spc_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input spc_file is expected to be a string&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid spc_file.&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">smv_file</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">smv_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__jtlvfile</span> <span class="o">+</span> <span class="s">&#39;.smv&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spc_file</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">spc_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__jtlvfile</span> <span class="o">+</span> <span class="s">&#39;.spc&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">smv_file</span><span class="p">)))):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">printWarning</span><span class="p">(</span><span class="s">&#39;Folder for smv_file &#39;</span> <span class="o">+</span> <span class="n">smv_file</span> <span class="o">+</span> \
                                 <span class="s">&#39; does not exist. Creating...&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">smv_file</span><span class="p">)))</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">spc_file</span><span class="p">)))):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">printWarning</span><span class="p">(</span><span class="s">&#39;Folder for spc_file &#39;</span> <span class="o">+</span> <span class="n">spc_file</span> <span class="o">+</span> \
                                 <span class="s">&#39; does not exist. Creating...&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">spc_file</span><span class="p">)))</span>

        <span class="c"># Check whether the smv or spc file exists</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">file_exist_option</span> <span class="o">!=</span> <span class="s">&#39;r&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">smv_file</span><span class="p">)):</span>
                <span class="n">printWarning</span><span class="p">(</span><span class="s">&#39;smv file: &#39;</span> <span class="o">+</span> <span class="n">smv_file</span> <span class="o">+</span> <span class="s">&#39; exists.&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">smv_file_exist_option</span> <span class="o">=</span> <span class="n">file_exist_option</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">smv_file_exist_option</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;r&#39;</span> <span class="ow">and</span> \
                           <span class="n">smv_file_exist_option</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;n&#39;</span><span class="p">):</span>
                    <span class="n">smv_file_exist_option</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Replace [r] or create a new smv file [n]: &#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">smv_file_exist_option</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;n&#39;</span><span class="p">):</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">smv_file_part</span> <span class="o">=</span> <span class="n">smv_file</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
                    <span class="n">smv_file</span> <span class="o">=</span> <span class="n">smv_file_part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">smv_file_part</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> \
                        <span class="n">smv_file_part</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">while</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">smv_file</span><span class="p">)):</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">smv_file</span> <span class="o">=</span> <span class="n">smv_file_part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">smv_file_part</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> \
                            <span class="n">smv_file_part</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;smv file: &#39;</span> <span class="o">+</span> <span class="n">smv_file</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">spc_file</span><span class="p">)):</span>
                <span class="n">printWarning</span><span class="p">(</span><span class="s">&#39;spc file: &#39;</span> <span class="o">+</span> <span class="n">spc_file</span> <span class="o">+</span> <span class="s">&#39; exists.&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">spc_file_exist_option</span> <span class="o">=</span> <span class="n">file_exist_option</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">spc_file_exist_option</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;r&#39;</span> <span class="ow">and</span> \
                           <span class="n">spc_file_exist_option</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;n&#39;</span><span class="p">):</span>
                    <span class="n">spc_file_exist_option</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Replace [r] or create a new spc file [n]: &#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">spc_file_exist_option</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;n&#39;</span><span class="p">):</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">spc_file_part</span> <span class="o">=</span> <span class="n">spc_file</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
                    <span class="n">spc_file</span> <span class="o">=</span> <span class="n">spc_file_part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">spc_file_part</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> \
                        <span class="n">spc_file_part</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">while</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">spc_file</span><span class="p">)):</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">spc_file</span> <span class="o">=</span> <span class="n">spc_file_part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">spc_file_part</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> \
                            <span class="n">spc_file_part</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;spc file: &#39;</span> <span class="o">+</span> <span class="n">spc_file</span><span class="p">)</span>


        <span class="c">###################################################################################</span>
        <span class="c"># Generate smv file</span>
        <span class="c">###################################################################################</span>
        <span class="n">env_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__env_vars</span>
        <span class="n">sys_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sys_vars</span>

        <span class="c"># Write smv file</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">smv_file</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="c">#   The use of &#39;with&#39; below is a better statement but is not supported in my </span>
    <span class="c">#   version of python</span>
    <span class="c">#   with open(smv_file, &#39;w&#39;) as f: </span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&#39;Generating smv file...&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;MODULE main </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">VAR</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t\t</span><span class="s">e : env();</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t\t</span><span class="s">s : sys();</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="c"># Environment</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;MODULE env </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">VAR</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">env_vars</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t\t</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s">&#39; : &#39;</span> <span class="o">+</span> <span class="n">val</span> <span class="o">+</span> <span class="s">&#39;;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="c"># System</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">MODULE sys </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">VAR</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">sys_vars</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t\t</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s">&#39; : &#39;</span> <span class="o">+</span> <span class="n">val</span> <span class="o">+</span> <span class="s">&#39;;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c">###################################################################################</span>
        <span class="c"># Generate spc file</span>
        <span class="c">###################################################################################</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="p">,</span> <span class="n">GRSpec</span><span class="p">)):</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span><span class="o">.</span><span class="n">toJTLVSpec</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__spec</span>
        <span class="n">assumption</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">guarantee</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">assumption</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="s">&#39;True&#39;</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;TRUE&#39;</span><span class="p">,</span> <span class="n">assumption</span><span class="p">)</span>
        <span class="n">guarantee</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="s">&#39;True&#39;</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;TRUE&#39;</span><span class="p">,</span> <span class="n">guarantee</span><span class="p">)</span>
        <span class="n">assumption</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="s">&#39;False&#39;</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;FALSE&#39;</span><span class="p">,</span> <span class="n">assumption</span><span class="p">)</span>
        <span class="n">guarantee</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="s">&#39;False&#39;</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;FALSE&#39;</span><span class="p">,</span> <span class="n">guarantee</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&#39;Generating spc file...&#39;</span>

        <span class="c"># Replace any environment variable var in spec with e.var and replace any </span>
        <span class="c"># system variable var with s.var</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">env_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">assumption</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="n">var</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;e.&#39;</span><span class="o">+</span><span class="n">var</span><span class="p">,</span> <span class="n">assumption</span><span class="p">)</span>
            <span class="n">guarantee</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="n">var</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;e.&#39;</span><span class="o">+</span><span class="n">var</span><span class="p">,</span> <span class="n">guarantee</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">sys_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">assumption</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="n">var</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;s.&#39;</span><span class="o">+</span><span class="n">var</span><span class="p">,</span> <span class="n">assumption</span><span class="p">)</span>
            <span class="n">guarantee</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="n">var</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;s.&#39;</span><span class="o">+</span><span class="n">var</span><span class="p">,</span> <span class="n">guarantee</span><span class="p">)</span>

        <span class="c"># Add assumption on the possible initial state of the system and all the possible </span>
        <span class="c"># values of the environment</span>
        <span class="n">env_values_formula</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">env_vars</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">all_values</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;[-+]?\d+&#39;</span><span class="p">,</span> <span class="n">reg</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">env_values_formula</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">env_values_formula</span> <span class="o">+=</span> <span class="s">&#39; &amp; &#39;</span>
                <span class="n">current_env_values_formula</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current_env_values_formula</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">current_env_values_formula</span> <span class="o">+=</span> <span class="s">&#39; | &#39;</span>
                    <span class="n">current_env_values_formula</span> <span class="o">+=</span> <span class="s">&#39;e.&#39;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s">&#39;=&#39;</span> <span class="o">+</span> <span class="n">val</span>
                <span class="n">env_values_formula</span> <span class="o">+=</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">current_env_values_formula</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>

        <span class="n">sys_values_formula</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">sys_vars</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">all_values</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;[-+]?\d+&#39;</span><span class="p">,</span> <span class="n">reg</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sys_values_formula</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">sys_values_formula</span> <span class="o">+=</span> <span class="s">&#39; &amp; &#39;</span>
                <span class="n">current_sys_values_formula</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current_sys_values_formula</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">current_sys_values_formula</span> <span class="o">+=</span> <span class="s">&#39; | &#39;</span>
                    <span class="n">current_sys_values_formula</span> <span class="o">+=</span> <span class="s">&#39;s.&#39;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s">&#39;=&#39;</span> <span class="o">+</span> <span class="n">val</span>
                <span class="n">sys_values_formula</span> <span class="o">+=</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">current_sys_values_formula</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>

        <span class="n">addAnd</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">assumption</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">assumption</span><span class="o">.</span><span class="n">isspace</span><span class="p">())):</span>
            <span class="n">assumption</span> <span class="o">=</span> <span class="n">assumption</span> 
            <span class="n">addAnd</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">env_values_formula</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">addAnd</span><span class="p">):</span>
                <span class="n">assumption</span> <span class="o">=</span> <span class="n">assumption</span> <span class="o">+</span> <span class="s">&#39; &amp;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">assumption</span> <span class="o">=</span> <span class="n">assumption</span> <span class="o">+</span> <span class="s">&#39;-- all initial environment states</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">assumption</span> <span class="o">=</span> <span class="n">assumption</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">(&#39;</span> <span class="o">+</span> <span class="n">env_values_formula</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
            <span class="n">assumption</span> <span class="o">=</span> <span class="n">assumption</span> <span class="o">+</span> <span class="s">&#39; &amp;</span><span class="se">\n</span><span class="s">-- possible values of environment variables</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">assumption</span> <span class="o">=</span> <span class="n">assumption</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">[](next(&#39;</span> <span class="o">+</span> <span class="n">env_values_formula</span> <span class="o">+</span> <span class="s">&#39;))&#39;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">spc_file</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>

        <span class="c"># Assumption</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;LTLSPEC</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">assumption</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="c"># Guarantee</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">LTLSPEC</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">addAnd</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">guarantee</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">guarantee</span><span class="o">.</span><span class="n">isspace</span><span class="p">())):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">guarantee</span><span class="p">)</span>
            <span class="n">addAnd</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sys_values_formula</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">addAnd</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &amp;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;-- all initial system states</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">(&#39;</span> <span class="o">+</span> <span class="n">sys_values_formula</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span><span class="p">)</span>
            <span class="n">addAnd</span> <span class="o">=</span> <span class="bp">True</span>        

        <span class="c"># Transitions for continuous dynamics</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_dynamics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">from_region</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_dynamics</span><span class="o">.</span><span class="n">num_regions</span><span class="p">):</span>
                <span class="n">to_regions</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_dynamics</span><span class="o">.</span><span class="n">num_regions</span><span class="p">)</span> <span class="k">if</span> \
                                  <span class="bp">self</span><span class="o">.</span><span class="n">__disc_dynamics</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">from_region</span><span class="p">]]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">addAnd</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &amp;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">from_region</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;-- transition relations for continuous dynamics</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">[]((s.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__disc_cont_var</span> <span class="o">+</span> <span class="s">&#39; = &#39;</span> <span class="o">+</span> \
                            <span class="nb">str</span><span class="p">(</span><span class="n">from_region</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;) -&gt; next(&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">to_regions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FALSE&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">to_region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">to_regions</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; | &#39;</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;(s.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__disc_cont_var</span> <span class="o">+</span> <span class="s">&#39; = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">to_region</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;))&#39;</span><span class="p">)</span>
                <span class="n">addAnd</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># Transitions</span>
        <span class="c"># For discrete transitions</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sys_values_formula</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">addAnd</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &amp;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;-- possible values of discrete system variables</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">);</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">[](next(&#39;</span> <span class="o">+</span> <span class="n">sys_values_formula</span> <span class="o">+</span> <span class="s">&#39;))&#39;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">;&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>



<span class="c">###################################################################</span>
</div></div>
<div class="viewcode-block" id="ShortHorizonProb"><a class="viewcode-back" href="../rhtlp.html#rhtlp.ShortHorizonProb">[docs]</a><span class="k">class</span> <span class="nc">ShortHorizonProb</span><span class="p">(</span><span class="n">SynthesisProb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ShortHorizonProb class for specifying a short horizon problem for receding horizon </span>
<span class="sd">    temporal logic planning.</span>
<span class="sd">    A ShortHorizonProb object contains the following fields:</span>

<span class="sd">    - `W`: a proposition that specifies a set W of states.</span>
<span class="sd">    - `FW`: a ShortHorizonProb object or a list of ShortHorizonProb object that specifies </span>
<span class="sd">      the set F(W).</span>
<span class="sd">    - `Phi`: a proposition that specifies the receding horizon invariant.</span>
<span class="sd">    - `global_prob`: a SynthesisProb object that represents the global problem.</span>

<span class="sd">    **Constructor**:</span>

<span class="sd">    **ShortHorizonProb** ([ `W` = &#39;&#39;[, `FW` = [][, `Phi` = &#39;&#39;[, `global_prob` = SynthesisProb()[, </span>
<span class="sd">    `file` = &#39;&#39;]]]]])</span>

<span class="sd">    **ShortHorizonProb** ([ `W` = &#39;&#39;[, `FW` = [][, `Phi` = &#39;&#39;[, `global_prob` = SynthesisProb()[, </span>
<span class="sd">    `env_vars` = {}[, `sys_disc_vars` = {}[, `disc_props` = {}[, `disc_dynamics` = None]]]]]]]])</span>

<span class="sd">    **ShortHorizonProb** ([ `W` = &#39;&#39;[, `FW` = [][, `Phi` = &#39;&#39;[, `global_prob` = SynthesisProb()[, </span>
<span class="sd">    `env_vars` = {}[, `sys_disc_vars` = {}[, `disc_props` = {}[, `cont_state_space` = None[, </span>
<span class="sd">    `cont_props` = {}[, `sys_dyn` = None]]]]]]]]]])</span>

<span class="sd">    - `W`: a proposition that specifies a set W of states.</span>
<span class="sd">    - `FW`: a ShortHorizonProb object or a list of ShortHorizonProb object that specifies </span>
<span class="sd">      the set F(W).</span>
<span class="sd">    - `Phi`: a proposition that specifies the receding horizon invariant.</span>
<span class="sd">    - `global_spec`: the global specification of the system.</span>
<span class="sd">    - `file`: the name of the rhtlp file to be parsed. If `file` is given,</span>
<span class="sd">      the rest of the inputs to this function will be ignored.</span>
<span class="sd">    - `env_vars`: a dictionary {str : str} or {str : list} whose keys are the names </span>
<span class="sd">      of environment variables and whose values are their possible values, e.g., </span>
<span class="sd">      boolean or {0, 2, ..., 5} or [0, 2, 3, 4, 5].</span>
<span class="sd">    - `sys_disc_vars`: a dictionary {str : str} or {str : list} whose keys are the </span>
<span class="sd">      names of discrete system variables and whose values are their possible values.</span>
<span class="sd">    - `disc_props`: a dictionary {str : str} whose keys are the symbols for </span>
<span class="sd">      propositions on discrete variables and whose values are the actual propositions</span>
<span class="sd">      on discrete variables.</span>
<span class="sd">    - `disc_dynamics`: a PropPreservingPartition object that represents the </span>
<span class="sd">      transition system obtained from the discretization procedure.</span>
<span class="sd">      if `disc_dynamics` is given, `cont_state_space`, `cont_props` and `sys_dyn`</span>
<span class="sd">      will be ignored.</span>
<span class="sd">    - `cont_state_space`: a Polytope object that represent the state space of the</span>
<span class="sd">      continuous variables. Needed only when `discretize` is True.</span>
<span class="sd">    - `cont_props`: a dictionary {str : Polytope} whose keys are the symbols for </span>
<span class="sd">      propositions on continuous variables and whose values are polytopes that represent</span>
<span class="sd">      the region in the state space in which the corresponding proposition hold.</span>
<span class="sd">      if `discretize` is False, `cont_props` can be just a list of symbols for </span>
<span class="sd">      propositions on continuous variables.</span>
<span class="sd">    - `sys_dyn`: a CtsSysDyn object that specifies the dynamics of the continuous variables.</span>
<span class="sd">      Needed only when `discretize` is True.</span>
<span class="sd">    - `verbose`: an integer that specifies the level of verbosity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">FW</span><span class="o">=</span><span class="p">[],</span> <span class="n">Phi</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">global_prob</span><span class="o">=</span><span class="n">SynthesisProb</span><span class="p">(),</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__W</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__FW</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__global_prob</span> <span class="o">=</span> <span class="n">SynthesisProb</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setW</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFW</span><span class="p">(</span><span class="n">FW</span><span class="o">=</span><span class="n">FW</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLocalPhi</span><span class="p">(</span><span class="n">Phi</span><span class="o">=</span><span class="n">Phi</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="n">verbose</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;verbose&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">global_prob</span><span class="p">,</span> <span class="n">SynthesisProb</span><span class="p">)):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input global_prob must be a SynthesisProb objects.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid global_prob.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__global_prob</span> <span class="o">=</span> <span class="n">global_prob</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__global_spec</span> <span class="o">=</span> <span class="n">global_prob</span><span class="o">.</span><span class="n">getSpec</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__global_spec</span><span class="o">.</span><span class="n">sym2prop</span><span class="p">(</span><span class="n">global_prob</span><span class="o">.</span><span class="n">getDiscProps</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">args</span><span class="p">[</span><span class="s">&#39;spec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__computeLocalSpec</span><span class="p">()</span>

        <span class="c"># For variables that are in the global problem but not in the local problem,</span>
        <span class="c"># make its possible value being False</span>
        <span class="n">global_env_vars</span> <span class="o">=</span> <span class="n">global_prob</span><span class="o">.</span><span class="n">getEnvVars</span><span class="p">()</span>
        <span class="n">global_sys_disc_vars</span> <span class="o">=</span> <span class="n">global_prob</span><span class="o">.</span><span class="n">getSysVars</span><span class="p">()</span>
        <span class="n">env_vars</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;env_vars&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">sys_disc_vars</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sys_disc_vars&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">disc_props</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;disc_props&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">global_env_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">env_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">disc_props</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;False&#39;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">global_sys_disc_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">sys_disc_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">disc_props</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;False&#39;</span>
        <span class="n">args</span><span class="p">[</span><span class="s">&#39;disc_props&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">disc_props</span>

        <span class="n">global_disc_props</span> <span class="o">=</span> <span class="n">global_prob</span><span class="o">.</span><span class="n">getDiscProps</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">global_disc_props</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">disc_props</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">disc_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">global_disc_props</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span>
        
        <span class="n">SynthesisProb</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>

<div class="viewcode-block" id="ShortHorizonProb.getGlobalSpec"><a class="viewcode-back" href="../rhtlp.html#rhtlp.ShortHorizonProb.getGlobalSpec">[docs]</a>    <span class="k">def</span> <span class="nf">getGlobalSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the global specification of this short horizon problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__global_spec</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ShortHorizonProb.setW"><a class="viewcode-back" href="../rhtlp.html#rhtlp.ShortHorizonProb.setW">[docs]</a>    <span class="k">def</span> <span class="nf">setW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the set W of this short horizon problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input W must be a string.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid W.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__W</span> <span class="o">=</span> <span class="n">W</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">update</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateLocalSpec</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ShortHorizonProb.getW"><a class="viewcode-back" href="../rhtlp.html#rhtlp.ShortHorizonProb.getW">[docs]</a>    <span class="k">def</span> <span class="nf">getW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the set W of this short horizon problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__W</span>
</div>
<div class="viewcode-block" id="ShortHorizonProb.setFW"><a class="viewcode-back" href="../rhtlp.html#rhtlp.ShortHorizonProb.setFW">[docs]</a>    <span class="k">def</span> <span class="nf">setFW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FW</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the set F(W) of this short horizon problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">FW</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">FW</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">FW</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">FW</span><span class="p">,</span> <span class="n">ShortHorizonProb</span><span class="p">)):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input FW must be a ShortHorizonProb object or &quot;</span> <span class="o">+</span> \
                           <span class="s">&quot;a list of ShortHorizonProb object.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid W.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">FW</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__FW</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">FW</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__FW</span> <span class="o">=</span> <span class="n">FW</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">update</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateLocalSpec</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ShortHorizonProb.getFW"><a class="viewcode-back" href="../rhtlp.html#rhtlp.ShortHorizonProb.getFW">[docs]</a>    <span class="k">def</span> <span class="nf">getFW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the set F(W) of this short horizon problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__FW</span>
</div>
<div class="viewcode-block" id="ShortHorizonProb.setLocalPhi"><a class="viewcode-back" href="../rhtlp.html#rhtlp.ShortHorizonProb.setLocalPhi">[docs]</a>    <span class="k">def</span> <span class="nf">setLocalPhi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Phi</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the local invariant Phi of this short horizon problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Phi</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input Phi must be a string.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid Phi.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">=</span> <span class="n">Phi</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">update</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateLocalSpec</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ShortHorizonProb.getLocalPhi"><a class="viewcode-back" href="../rhtlp.html#rhtlp.ShortHorizonProb.getLocalPhi">[docs]</a>    <span class="k">def</span> <span class="nf">getLocalPhi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow_disc_cont_var</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the local invariant Phi of this short horizon problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">disc_dynamics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedDynamics</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">allow_disc_cont_var</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSysVars</span><span class="p">()</span> <span class="ow">or</span> \
                <span class="n">disc_dynamics</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_prop_symbol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span>

        <span class="c"># Replace disc_cont_var in Phi with cont_prop</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span>
        <span class="n">cont_props</span> <span class="o">=</span> <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_prop_symbol</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">num_regions</span><span class="p">):</span>
            <span class="n">prop_id</span> <span class="o">=</span> <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_region</span><span class="p">[</span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">list_prop</span>
            <span class="n">prop_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop_id</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prop_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">prop_str</span> <span class="o">+=</span> <span class="s">&#39; &amp; &#39;</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">prop_id</span><span class="p">[</span><span class="n">ind</span><span class="p">]):</span>
                    <span class="n">prop_str</span> <span class="o">+=</span> <span class="s">&#39; !&#39;</span>
                <span class="n">prop_str</span> <span class="o">+=</span> <span class="n">cont_props</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="s">&#39;\s*=\s*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> \
                             <span class="s">&#39;(&#39;</span><span class="o">+</span><span class="n">prop_str</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="ShortHorizonProb.updateLocalSpec"><a class="viewcode-back" href="../rhtlp.html#rhtlp.ShortHorizonProb.updateLocalSpec">[docs]</a>    <span class="k">def</span> <span class="nf">updateLocalSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the short horizon specification based on the current W, FW and Phi.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">local_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__computeLocalSpec</span><span class="p">()</span>
        <span class="n">sys_disc_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSysDiscVars</span><span class="p">()</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">createProbFromDiscDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnvVars</span><span class="p">(),</span> <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                            <span class="n">disc_props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscProps</span><span class="p">(),</span> \
                                            <span class="n">disc_dynamics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedDynamics</span><span class="p">(),</span> \
                                            <span class="n">spec</span><span class="o">=</span><span class="n">local_spec</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__computeLocalSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">local_spec</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__global_spec</span><span class="p">)</span>
        <span class="n">local_spec</span><span class="o">.</span><span class="n">sys_init</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">local_spec</span><span class="o">.</span><span class="n">env_init</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__W</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">local_spec</span><span class="o">.</span><span class="n">env_init</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">local_spec</span><span class="o">.</span><span class="n">env_init</span> <span class="o">+=</span> <span class="s">&#39; &amp; </span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">local_spec</span><span class="o">.</span><span class="n">env_init</span> <span class="o">+=</span> <span class="s">&#39;-- W</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">local_spec</span><span class="o">.</span><span class="n">env_init</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">(&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__W</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">local_spec</span><span class="o">.</span><span class="n">env_init</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">local_spec</span><span class="o">.</span><span class="n">env_init</span> <span class="o">+=</span> <span class="s">&#39; &amp; </span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">local_spec</span><span class="o">.</span><span class="n">env_init</span> <span class="o">+=</span> <span class="s">&#39;-- Phi</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">local_spec</span><span class="o">.</span><span class="n">env_init</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">(&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">local_spec</span><span class="o">.</span><span class="n">sys_safety</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">local_spec</span><span class="o">.</span><span class="n">sys_safety</span> <span class="o">+=</span> <span class="s">&#39; &amp; </span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">local_spec</span><span class="o">.</span><span class="n">sys_safety</span> <span class="o">+=</span> <span class="s">&#39;-- Phi</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">local_spec</span><span class="o">.</span><span class="n">sys_safety</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">(&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>

        <span class="n">local_spec</span><span class="o">.</span><span class="n">sys_prog</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__FW</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__FW</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__FW</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">fw</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__FW</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fw</span><span class="o">.</span><span class="n">getW</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">fw</span><span class="o">.</span><span class="n">getW</span><span class="p">()</span><span class="o">.</span><span class="n">isspace</span><span class="p">()):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">local_spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">local_spec</span><span class="o">.</span><span class="n">sys_prog</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fw</span><span class="o">.</span><span class="n">getW</span><span class="p">()]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">local_spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">local_spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&#39; &amp; &#39;</span>
                    <span class="n">local_spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fw</span><span class="o">.</span><span class="n">getW</span><span class="p">()</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__FW</span><span class="p">,</span> <span class="n">ShortHorizonProb</span><span class="p">)):</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__FW</span><span class="o">.</span><span class="n">getW</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__FW</span><span class="o">.</span><span class="n">getW</span><span class="p">()</span><span class="o">.</span><span class="n">isspace</span><span class="p">()):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">local_spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">local_spec</span><span class="o">.</span><span class="n">sys_prog</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__FW</span><span class="o">.</span><span class="n">getW</span><span class="p">()]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">local_spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">local_spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&#39; &amp; &#39;</span>
                    <span class="n">local_spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__FW</span><span class="o">.</span><span class="n">getW</span><span class="p">()</span>
                
        
<span class="c">#         local_spec.sym2prop(self.__disc_props, verbose=verbose)</span>
        <span class="k">return</span> <span class="n">local_spec</span>


<div class="viewcode-block" id="ShortHorizonProb.computeLocalPhi"><a class="viewcode-back" href="../rhtlp.html#rhtlp.ShortHorizonProb.computeLocalPhi">[docs]</a>    <span class="k">def</span> <span class="nf">computeLocalPhi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the local Phi for this ShortHorizonProb object.</span>
<span class="sd">        Return a boolean that indicates whether the local Phi gets updated.</span>
<span class="sd">        If the current prob is realizable, then the local Phi is not updated and this</span>
<span class="sd">        function will return False.</span>
<span class="sd">        Otherwise, the local Phi will get updated and this function wil return True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateLocalSpec</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">counter_examples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCounterExamples</span><span class="p">(</span><span class="n">recompute</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">pick_sys_init</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> \
                                                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">counter_examples</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span><span class="o">.</span><span class="n">isspace</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
            <span class="k">for</span> <span class="n">ce</span> <span class="ow">in</span> <span class="n">counter_examples</span><span class="p">:</span>
                <span class="n">ce_formula</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">ce</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ce_formula</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">ce_formula</span> <span class="o">+=</span> <span class="s">&#39; &amp; &#39;</span>
                    <span class="n">ce_formula</span> <span class="o">+=</span> <span class="n">var</span> <span class="o">+</span> <span class="s">&#39; = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">+=</span> <span class="s">&#39; &amp; &#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">+=</span> <span class="s">&#39;!(&#39;</span> <span class="o">+</span> <span class="n">ce_formula</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
            <span class="k">return</span> <span class="bp">True</span>



<span class="c">###################################################################</span>

</div></div>
<div class="viewcode-block" id="RHTLPProb"><a class="viewcode-back" href="../rhtlp.html#rhtlp.RHTLPProb">[docs]</a><span class="k">class</span> <span class="nc">RHTLPProb</span><span class="p">(</span><span class="n">SynthesisProb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    RHTLPProb class for specifying a receding horizon temporal logic planning problem.</span>
<span class="sd">    A RHTLPProb object contains the following fields:</span>

<span class="sd">    - `shprobs`: a list of ShortHorizonProb objects</span>
<span class="sd">    - `Phi`: the invariant for the RHTLP problem</span>

<span class="sd">    **Constructor**:</span>

<span class="sd">    **RHTLPProb** ([ `shprobs` = [][, `Phi` = &#39;True&#39;[, `discretize` = False[, `file` = &#39;&#39;]]]]): </span>
<span class="sd">    construct this SynthesisProb object from `file`.</span>

<span class="sd">    **RHTLPProb** ([ `shprobs` = [][, `Phi` = &#39;True&#39;[, `discretize` = False[, `env_vars` = {}[, `</span>
<span class="sd">    sys_disc_vars` = {}[, `disc_props` = {}[, `disc_dynamics` = None[, </span>
<span class="sd">    `spec` = GRSpec()]]]]]]]])</span>

<span class="sd">    **RHTLPProb** ([ `shprobs` = [][, `Phi` = &#39;True&#39;[, `discretize` = False[, `env_vars` = {}[, </span>
<span class="sd">    `sys_disc_vars` = {}[, `disc_props` = {}[, `cont_state_space` = None[, </span>
<span class="sd">    `cont_props` = {}[, `sys_dyn` = None[, `spec` = GRSpec()]]]]]]])</span>

<span class="sd">    - `shprobs`: a list of ShortHorizonProb objects.</span>
<span class="sd">    - `Phi`: a string specifying the invariant for the RHTLP problem.</span>
<span class="sd">    - `discretize`:  a boolean indicating whether to discretize the global problem.</span>
<span class="sd">    - `file`: the name of the rhtlp file to be parsed. If `file` is given,</span>
<span class="sd">      the rest of the inputs to this function will be ignored.</span>
<span class="sd">    - `env_vars`: a dictionary {str : str} or {str : list} whose keys are the names </span>
<span class="sd">      of environment variables and whose values are their possible values, e.g., </span>
<span class="sd">      boolean or {0, 2, ..., 5} or [0, 2, 3, 4, 5].</span>
<span class="sd">    - `sys_disc_vars`: a dictionary {str : str} or {str : list} whose keys are the </span>
<span class="sd">      names of discrete system variables and whose values are their possible values.</span>
<span class="sd">    - `disc_props`: a dictionary {str : str} whose keys are the symbols for </span>
<span class="sd">      propositions on discrete variables and whose values are the actual propositions</span>
<span class="sd">      on discrete variables.</span>
<span class="sd">    - `disc_dynamics`: a PropPreservingPartition object that represents the </span>
<span class="sd">      transition system obtained from the discretization procedure.</span>
<span class="sd">      if `disc_dynamics` is given, `cont_state_space`, `cont_props` and `sys_dyn`</span>
<span class="sd">      will be ignored.</span>
<span class="sd">    - `cont_state_space`: a Polytope object that represent the state space of the</span>
<span class="sd">      continuous variables. Needed only when `discretize` is True.</span>
<span class="sd">    - `cont_props`: a dictionary {str : Polytope} whose keys are the symbols for </span>
<span class="sd">      propositions on continuous variables and whose values are polytopes that represent</span>
<span class="sd">      the region in the state space in which the corresponding proposition hold.</span>
<span class="sd">      if `discretize` is False, `cont_props` can be just a list of symbols for </span>
<span class="sd">      propositions on continuous variables.</span>
<span class="sd">    - `sys_dyn`: a CtsSysDyn object that specifies the dynamics of the continuous variables.</span>
<span class="sd">      Needed only when `discretize` is True.</span>
<span class="sd">    - `spec`: a GRSpec object that specifies the specification of this synthesis problem</span>
<span class="sd">    - `verbose`: an integer that specifies the level of verbosity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shprobs</span><span class="o">=</span><span class="p">[],</span> <span class="n">Phi</span><span class="o">=</span><span class="s">&#39;True&#39;</span><span class="p">,</span> <span class="n">discretize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">=</span> <span class="s">&#39;True&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cont_props</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sys_prog</span> <span class="o">=</span> <span class="s">&#39;True&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__all_init</span> <span class="o">=</span> <span class="s">&#39;True&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shprobs</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">shprob</span> <span class="ow">in</span> <span class="n">shprobs</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shprob</span><span class="p">,</span> <span class="n">ShortHorizonProb</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shprob</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input shprobs must be &quot;</span> <span class="o">+</span> \
                                   <span class="s">&quot;a list of ShortHorizonProb objects.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">shprobs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input shprobs must be &quot;</span> <span class="o">+</span> \
                           <span class="s">&quot;a list of ShortHorizonProb objects.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">Phi</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">=</span> <span class="n">Phi</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input Phi must be a string.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        
        
        <span class="n">verbose</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;verbose&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;disc_props&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;disc_props&#39;</span><span class="p">])</span>

        <span class="n">cont_props</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cont_props&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cont_props</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cont_props</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cont_props</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cont_props</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cont_props</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cont_props</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input cont_props is expected to be a dictionary &quot;</span> <span class="o">+</span> \
                           <span class="s">&quot;{str : Polytope}&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid cont_props.&quot;</span><span class="p">)</span>
                
        <span class="n">spec</span> <span class="o">=</span> <span class="n">GRSpec</span><span class="p">(</span><span class="n">env_init</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">sys_init</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">env_safety</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">sys_safety</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> \
                          <span class="n">env_prog</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">sys_prog</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;spec&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;spec&#39;</span><span class="p">],</span> <span class="n">GRSpec</span><span class="p">)):</span>
                <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input spec must be a GRSpec objects.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid spec.&quot;</span><span class="p">)</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;spec&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input spec can have at most one system progress formula.&quot;</span><span class="p">,</span> \
                               <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid spec.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__sys_prog</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">sys_prog</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
                      <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__sys_prog</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">sys_prog</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">sys_init</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">sys_init</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__all_init</span> <span class="o">+=</span> <span class="s">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="n">spec</span><span class="o">.</span><span class="n">sys_init</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">sys_init</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">init_cond</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">sys_init</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">init_cond</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__all_init</span> <span class="o">+=</span> <span class="s">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="n">init_cond</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">env_init</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">env_init</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__all_init</span> <span class="o">+=</span> <span class="s">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="n">spec</span><span class="o">.</span><span class="n">env_init</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">env_init</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">init_cond</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">env_init</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">init_cond</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__all_init</span> <span class="o">+=</span> <span class="s">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="n">init_cond</span>

        <span class="n">env_vars</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;env_vars&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">sys_disc_vars</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sys_disc_vars&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">cont_state_space</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">sys_dyn</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">disc_dynamics</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;file&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">]</span>
            <span class="c"># Check that the input is valid</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input file is expected to be a string&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid file.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="nb">file</span><span class="p">)):</span>
                <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The rhtlp file &quot;</span> <span class="o">+</span> <span class="nb">file</span> <span class="o">+</span> <span class="s">&quot; does not exist.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid file.&quot;</span><span class="p">)</span>

            <span class="p">(</span><span class="n">env_vars</span><span class="p">,</span> <span class="n">sys_disc_vars</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span><span class="p">,</span> <span class="n">sys_cont_vars</span><span class="p">,</span> <span class="n">cont_state_space</span><span class="p">,</span> \
                 <span class="n">cont_props</span><span class="p">,</span> <span class="n">sys_dyn</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span> <span class="o">=</span> <span class="n">parseSpec</span><span class="p">(</span><span class="n">spec_file</span><span class="o">=</span><span class="nb">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cont_props</span> <span class="o">=</span> <span class="n">cont_props</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">elif</span> <span class="p">(</span><span class="s">&#39;disc_dynamics&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">discretize</span><span class="p">):</span>
                <span class="n">printWarning</span><span class="p">(</span><span class="s">&#39;Discretized dynamics is already given.&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">discretize</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">disc_dynamics</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s">&#39;disc_dynamics&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__cont_props</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">disc_dynamics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_prop_symbol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__cont_props</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_prop_symbol</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">disc_dynamics</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_prop_symbol</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                        <span class="ow">not</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__cont_props</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_prop_symbol</span><span class="p">))):</span>
                    <span class="n">printWarning</span><span class="p">(</span><span class="s">&quot;The given cont_prop does not match the propositions&quot;</span> <span class="o">+</span> \
                                     <span class="s">&quot; in the given disc_dynamics&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="n">cont_state_space</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cont_state_space&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">sys_dyn</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sys_dyn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">discretize</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createProbFromContDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> \
                                                <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                                <span class="n">disc_props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span><span class="p">,</span> \
                                                <span class="n">cont_state_space</span><span class="o">=</span><span class="n">cont_state_space</span><span class="p">,</span> \
                                                <span class="n">cont_props</span><span class="o">=</span><span class="n">cont_props</span><span class="p">,</span> \
                                                <span class="n">sys_dyn</span><span class="o">=</span><span class="n">sys_dyn</span><span class="p">,</span> \
                                                <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> \
                                                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createProbFromDiscDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> \
                                                <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                                <span class="n">disc_props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span><span class="p">,</span> \
                                                <span class="n">disc_dynamics</span><span class="o">=</span><span class="n">disc_dynamics</span><span class="p">,</span> \
                                                <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> \
                                                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>


<div class="viewcode-block" id="RHTLPProb.addSHProb"><a class="viewcode-back" href="../rhtlp.html#rhtlp.RHTLPProb.addSHProb">[docs]</a>    <span class="k">def</span> <span class="nf">addSHProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shprob</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a short horizon problem to this RHTLP problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shprob</span><span class="p">,</span> <span class="n">ShortHorizonProb</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shprob</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;The input shprob must be a ShortHorizonProb object.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="RHTLPProb.getPhi"><a class="viewcode-back" href="../rhtlp.html#rhtlp.RHTLPProb.getPhi">[docs]</a>    <span class="k">def</span> <span class="nf">getPhi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the global invariant Phi for this RHTLP problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span>
</div>
    <span class="k">def</span> <span class="nf">__replacePropSymbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formula</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">newformula</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
        <span class="c"># disc_prop</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">propSymbol</span><span class="p">,</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__disc_props</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">propSymbol</span> <span class="o">+</span> <span class="s">&#39; -&gt; &#39;</span> <span class="o">+</span> <span class="n">prop</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">newformula</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">newformula</span><span class="p">)):</span>
                        <span class="n">newformula</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="n">propSymbol</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;(&#39;</span><span class="o">+</span><span class="n">prop</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">,</span> \
                                                     <span class="n">newformula</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">newformula</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                    <span class="n">newformula</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="n">propSymbol</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;(&#39;</span><span class="o">+</span><span class="n">prop</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="n">newformula</span><span class="p">)</span>

        <span class="c"># Replace any cont_prop XC by (s.p = P1) | (s.p = P2) | ... | (s.p = Pn) where </span>
        <span class="c"># P1, ..., Pn are cells in disc_dynamics that satisfy XC</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSysVars</span><span class="p">()</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedDynamics</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedDynamics</span><span class="p">()</span><span class="o">.</span><span class="n">list_prop_symbol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">disc_dynamics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedDynamics</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">propInd</span><span class="p">,</span> <span class="n">propSymbol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_prop_symbol</span><span class="p">):</span>
                <span class="n">reg</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">num_regions</span><span class="p">)</span> <span class="k">if</span> \
                           <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_region</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">list_prop</span><span class="p">[</span><span class="n">propInd</span><span class="p">]]</span>
                <span class="n">prop</span> <span class="o">=</span> <span class="s">&#39;FALSE&#39;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">prop</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">regID</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reg</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="n">prop</span> <span class="o">+=</span> <span class="s">&#39; | &#39;</span>
                        <span class="n">prop</span> <span class="o">+=</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39; = &#39;</span> <span class="o">+</span> \
                            <span class="nb">str</span><span class="p">(</span><span class="n">regID</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">propSymbol</span> <span class="o">+</span> <span class="s">&#39; -&gt; &#39;</span> <span class="o">+</span> <span class="n">prop</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">newformula</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">newformula</span><span class="p">)):</span>
                        <span class="n">newformula</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="n">propSymbol</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;(&#39;</span><span class="o">+</span><span class="n">prop</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">,</span> \
                                                     <span class="n">newformula</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">newformula</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                    <span class="n">newformula</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\b&#39;</span><span class="o">+</span><span class="n">propSymbol</span><span class="o">+</span><span class="s">r&#39;\b&#39;</span><span class="p">,</span> <span class="s">&#39;(&#39;</span><span class="o">+</span><span class="n">prop</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="n">newformula</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newformula</span>


    <span class="k">def</span> <span class="nf">__getAllVars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span> 
        <span class="n">allvars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnvVars</span><span class="p">()</span>
        <span class="n">sys_disc_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSysVars</span><span class="p">()</span>
        <span class="n">allvars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sys_disc_vars</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> \
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span> <span class="ow">in</span> <span class="n">sys_disc_vars</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">__cont_props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cont_props</span><span class="p">:</span>
                <span class="n">allvars</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;boolean&#39;</span>

        <span class="n">allvars_values</span> <span class="o">=</span> <span class="p">()</span>
        <span class="n">allvars_variables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">allvars</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s">&#39;boolean&#39;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">):</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&#39;[-+]?\d+&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">]</span>
            <span class="n">allvars_values</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">,</span>
            <span class="n">allvars_variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">allvars_variables</span><span class="p">,</span> <span class="n">allvars_values</span>


    <span class="k">def</span> <span class="nf">__checkcovering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">allW_formula</span> <span class="o">=</span> <span class="s">&#39;False&#39;</span>
        <span class="k">for</span> <span class="n">shprob</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span><span class="p">:</span>
            <span class="n">allW_formula</span> <span class="o">+=</span> <span class="s">&#39; | (&#39;</span> <span class="o">+</span> <span class="n">shprob</span><span class="o">.</span><span class="n">getW</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&#39;W = &#39;</span> <span class="o">+</span> <span class="n">allW_formula</span>

        <span class="p">(</span><span class="n">allvars_variables</span><span class="p">,</span> <span class="n">allvars_values</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getAllVars</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="n">allvars_values_iter</span> <span class="o">=</span> <span class="n">rhtlputil</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">allvars_values</span><span class="p">)</span>
        <span class="n">vardict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">allvars_values_iter</span><span class="p">:</span>
            <span class="n">vardict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">allvars_variables</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
<span class="c">#             for i in xrange(0, len(allvars_variables)):</span>
<span class="c">#                 vardict[allvars_variables[i]] = int(val[i])</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">rhtlputil</span><span class="o">.</span><span class="n">evalExpr</span><span class="p">(</span><span class="n">allW_formula</span><span class="p">,</span> <span class="n">vardict</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">printError</span><span class="p">(</span><span class="s">&#39;Invalid W&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">print</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">vardict</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ret</span><span class="p">):</span>
<span class="c">#                 state = dict(zip(allvars_variables, val))</span>
<span class="c">#                 state = &#39;&#39;</span>
<span class="c">#                 for i in xrange(0, len(allvars_variables)):</span>
<span class="c">#                     if (len(state) &gt; 0):</span>
<span class="c">#                         state += &#39;, &#39;</span>
<span class="c">#                     state += allvars_variables[i] + &#39;:&#39; + str(val[i])</span>
<span class="c">#                 printError(&#39;state &lt;&#39; + state + &#39;&gt; is not in any W&#39;, obj=self)</span>
                <span class="k">return</span> <span class="n">vardict</span>
        <span class="k">return</span> <span class="bp">True</span>


    <span class="k">def</span> <span class="nf">__constructWGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">wind</span><span class="p">,</span> <span class="n">shprob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shprob</span><span class="o">.</span><span class="n">getFW</span><span class="p">(),</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="n">fw_ind</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">fw</span> <span class="ow">in</span> <span class="n">shprob</span><span class="o">.</span><span class="n">getFW</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">fw</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                        <span class="n">fw_ind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fw</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">fw</span><span class="p">,</span> <span class="n">ShortHorizonProb</span><span class="p">)):</span>
                        <span class="n">tmpind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findWInd</span><span class="p">(</span><span class="n">fw</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">tmpind</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="n">fw_ind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpind</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">printError</span><span class="p">(</span><span class="s">&quot;FW for shprobs[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">wind</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span> <span class="o">+</span> \
                                           <span class="s">&quot; is not in this RHTLPProb.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Invalid FW.&quot;</span><span class="p">)</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fw_ind</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">printError</span><span class="p">(</span><span class="s">&quot;Invalid FW&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid FW.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shprob</span><span class="o">.</span><span class="n">getFW</span><span class="p">(),</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">shprob</span><span class="o">.</span><span class="n">getFW</span><span class="p">()])</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shprob</span><span class="o">.</span><span class="n">getFW</span><span class="p">(),</span> <span class="n">ShortHorizonProb</span><span class="p">)):</span>
                <span class="n">fw_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findWInd</span><span class="p">(</span><span class="n">fw</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">tmpind</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">fw_ind</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">printError</span><span class="p">(</span><span class="s">&quot;FW for shprobs[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">wind</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span> <span class="o">+</span> \
                                   <span class="s">&quot; is not in this RHTLPProb.&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Invalid FW.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">printError</span><span class="p">(</span><span class="s">&quot;Invalid FW for shprobs[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">wind</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;].&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid FW.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span>


    <span class="k">def</span> <span class="nf">__findWInd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">ind</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">W</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span><span class="p">[</span><span class="n">ind</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">ind</span>
            <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>


    <span class="k">def</span> <span class="nf">__findW0Ind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">W0ind</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__sys_prog</span> <span class="o">==</span> <span class="bp">True</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">W0ind</span>

        <span class="p">(</span><span class="n">allvars_variables</span><span class="p">,</span> <span class="n">allvars_values</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getAllVars</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="n">allvars_values_iter</span> <span class="o">=</span> <span class="n">rhtlputil</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">allvars_values</span><span class="p">)</span>
        <span class="n">vardict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">allvars_values_iter</span><span class="p">:</span>
            <span class="n">vardict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">allvars_variables</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">rhtlputil</span><span class="o">.</span><span class="n">evalExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__sys_prog</span><span class="p">,</span> <span class="n">vardict</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">printError</span><span class="p">(</span><span class="s">&#39;Invalid W&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">print</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">print</span> <span class="n">vardict</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">):</span>
                <span class="n">newW0ind</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">W0ind</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">rhtlputil</span><span class="o">.</span><span class="n">evalExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">getW</span><span class="p">(),</span> <span class="n">vardict</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">):</span>
                        <span class="n">newW0ind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">print</span> <span class="s">&#39;W[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;] does not satisfy spec.sys_prog&#39;</span>
                        <span class="k">print</span> <span class="s">&#39;counter example: &#39;</span><span class="p">,</span> <span class="n">vardict</span>
                <span class="n">W0ind</span> <span class="o">=</span> <span class="n">newW0ind</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">W0ind</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">W0ind</span>
        <span class="k">return</span> <span class="n">W0ind</span>


    <span class="k">def</span> <span class="nf">__checkTautologyPhi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__all_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__replacePropSymbols</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__all_init</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__replacePropSymbols</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c"># Check whether self.__all_init -&gt; Phi is a tautology</span>
        <span class="p">(</span><span class="n">allvars_variables</span><span class="p">,</span> <span class="n">allvars_values</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getAllVars</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">allvars_values_iter</span> <span class="o">=</span> <span class="n">rhtlputil</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">allvars_values</span><span class="p">)</span>
        <span class="n">vardict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">allvars_values_iter</span><span class="p">:</span>
            <span class="n">vardict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">allvars_variables</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">rhtlputil</span><span class="o">.</span><span class="n">evalExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__all_init</span><span class="p">,</span> <span class="n">vardict</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">printError</span><span class="p">(</span><span class="s">&#39;Invalid initial condition&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">print</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">rhtlputil</span><span class="o">.</span><span class="n">evalExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span><span class="p">,</span> <span class="n">vardict</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">printError</span><span class="p">(</span><span class="s">&#39;Invalid Phi&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                    <span class="k">print</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">return</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ret</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">printInfo</span><span class="p">(</span><span class="s">&#39;sys_init -&gt; Phi is not a tautology&#39;</span><span class="p">)</span>
                        <span class="k">print</span> <span class="s">&#39;counter example: &#39;</span><span class="p">,</span> <span class="n">vardict</span>
                    <span class="k">return</span> <span class="bp">False</span>


<div class="viewcode-block" id="RHTLPProb.updatePhi"><a class="viewcode-back" href="../rhtlp.html#rhtlp.RHTLPProb.updatePhi">[docs]</a>    <span class="k">def</span> <span class="nf">updatePhi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update Phi for this RHTLPProb object based on the local Phi</span>
<span class="sd">        in the short horizon problems.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span><span class="o">.</span><span class="n">isspace</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">=</span> <span class="s">&#39;True&#39;</span>

        <span class="n">allow_disc_cont_var</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> \
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSysVars</span><span class="p">()</span> <span class="ow">or</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedDynamics</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedDynamics</span><span class="p">()</span><span class="o">.</span><span class="n">list_prop_symbol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">allow_disc_cont_var</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">for</span> <span class="n">shprob</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span><span class="p">:</span>
            <span class="n">localPhi</span> <span class="o">=</span> <span class="n">shprob</span><span class="o">.</span><span class="n">getLocalPhi</span><span class="p">(</span><span class="n">allow_disc_cont_var</span><span class="o">=</span><span class="n">allow_disc_cont_var</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">localPhi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">localPhi</span><span class="o">.</span><span class="n">isspace</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">+=</span> <span class="s">&#39; &amp; (&#39;</span> <span class="o">+</span> <span class="n">localPhi</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__replacePropSymbols</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="RHTLPProb.computePhi"><a class="viewcode-back" href="../rhtlp.html#rhtlp.RHTLPProb.computePhi">[docs]</a>    <span class="k">def</span> <span class="nf">computePhi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checktautology</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute Phi for this RHTLPProb object.</span>
<span class="sd">        Return a boolean that indicates whether a valid Phi exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatePhi</span><span class="p">(</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">)</span>
        <span class="n">allow_disc_cont_var</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> \
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedContVar</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSysVars</span><span class="p">()</span> <span class="ow">or</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedDynamics</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">getDiscretizedDynamics</span><span class="p">()</span><span class="o">.</span><span class="n">list_prop_symbol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">allow_disc_cont_var</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">done</span><span class="p">):</span>
            <span class="n">done</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">shprob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">checktautology</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="k">print</span> <span class="s">&quot;Checking tautology of init -&gt; Phi for shprob[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;].&#39;</span>
                    <span class="n">tautology</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkTautologyPhi</span><span class="p">(</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">tautology</span><span class="p">):</span>
                        <span class="k">return</span> <span class="bp">False</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">print</span> <span class="s">&quot;Setting local Phi of shprob[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;].&#39;</span>
                <span class="n">shprob</span><span class="o">.</span><span class="n">setLocalPhi</span><span class="p">(</span><span class="n">Phi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">print</span> <span class="s">&quot;Computing local Phi of shprob[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;].&#39;</span>
                <span class="n">phi_updated</span> <span class="o">=</span> <span class="n">shprob</span><span class="o">.</span><span class="n">computeLocalPhi</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">phi_updated</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">print</span> <span class="s">&quot;Updating Phi.&quot;</span>
                    <span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span> <span class="o">=</span> <span class="n">shprob</span><span class="o">.</span><span class="n">getLocalPhi</span><span class="p">(</span><span class="n">allow_disc_cont_var</span><span class="o">=</span><span class="n">allow_disc_cont_var</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="RHTLPProb.validate"><a class="viewcode-back" href="../rhtlp.html#rhtlp.RHTLPProb.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkcovering</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">checkpartial_order</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">checktautology</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> \
                     <span class="n">checkrealizable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">heap_size</span><span class="o">=</span><span class="s">&#39;-Xmx128m&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether the list of ShortHorizonProb objects satisfies the sufficient</span>
<span class="sd">        conditions for receding horizon temporal logic planning</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sys_prog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__replacePropSymbols</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sys_prog</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">shprob</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span><span class="p">:</span>
            <span class="n">shprob</span><span class="o">.</span><span class="n">setW</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__replacePropSymbols</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span> <span class="n">shprob</span><span class="o">.</span><span class="n">getW</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">),</span> \
                            <span class="n">update</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>


        <span class="c"># First, make sure that the union of W&#39;s covers the entire state space</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">checkcovering</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&#39;Checking that the union of W covers the entire state space...&#39;</span>
            <span class="n">vardict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkcovering</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">vardict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>                
                <span class="n">printInfo</span><span class="p">(</span><span class="s">&#39;state &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vardict</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; is not in any W&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="c"># Check the partial order condition</span>
        <span class="n">W0ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findW0Ind</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">checkpartial_order</span><span class="p">):</span>
            <span class="c"># No cycle</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&#39;Checking that the partial order condition is satisfied...&#39;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">print</span> <span class="s">&#39;Checking that there is no cycle...&#39;</span>
            <span class="n">wgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__constructWGraph</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">cycle</span> <span class="o">=</span> <span class="n">rhtlputil</span><span class="o">.</span><span class="n">findCycle</span><span class="p">(</span><span class="n">wgraph</span><span class="p">,</span> <span class="n">W0ind</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">cycleStr</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cycleStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">cycleStr</span> <span class="o">+=</span> <span class="s">&#39; -&gt; &#39;</span>
                    <span class="n">cycleStr</span> <span class="o">+=</span> <span class="s">&#39;W[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;]&#39;</span>
                <span class="n">printInfo</span><span class="p">(</span><span class="s">&#39;Partial order condition is violated due to the cycle &#39;</span> <span class="o">+</span> <span class="n">cycleStr</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="c"># Path to W0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&#39;Checking that there is a path to W0...&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">W0ind</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">printInfo</span><span class="p">(</span><span class="s">&#39;Partial order condition violated. &#39;</span> <span class="o">+</span> \
                              <span class="s">&#39;No W0 since all W do not satisfy spec.sys_prog&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">W0ind</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">W0indStr</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">W0ind</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">ind</span> <span class="o">!=</span> <span class="n">W0ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                            <span class="n">W0indStr</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span>
                        <span class="n">W0indStr</span> <span class="o">+=</span> <span class="s">&#39;W[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;]&#39;</span>
                    <span class="k">print</span> <span class="n">W0indStr</span> <span class="o">+</span> <span class="s">&#39; satisfy spec.sys_prog.&#39;</span>

            <span class="k">for</span> <span class="n">wind</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">wind</span> <span class="ow">in</span> <span class="n">W0ind</span><span class="p">):</span>
                    <span class="n">path_found</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">for</span> <span class="n">w0ind</span> <span class="ow">in</span> <span class="n">W0ind</span><span class="p">:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="n">rhtlputil</span><span class="o">.</span><span class="n">findPath</span><span class="p">(</span><span class="n">wgraph</span><span class="p">,</span> <span class="n">wind</span><span class="p">,</span> <span class="n">w0ind</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="n">path_found</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">path_found</span><span class="p">):</span>
                        <span class="n">printInfo</span><span class="p">(</span><span class="s">&#39;Partial order condition violated. &#39;</span> <span class="o">+</span> \
                                      <span class="s">&#39;No path from W[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">wind</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; to W0&#39;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="bp">False</span>
                
        <span class="c"># Check that all_init -&gt; Phi is a tautology</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">checktautology</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&#39;Checking that init -&gt; Phi is a tautology...&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updatePhi</span><span class="p">(</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">)</span>
            <span class="n">tautology</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__checkTautologyPhi</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">tautology</span><span class="p">):</span>
                <span class="n">printInfo</span><span class="p">(</span><span class="s">&#39;init -&gt; Phi is not a tautology.&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="c"># Check that all the short horizon specs are realizable</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">checkrealizable</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&#39;Checking that all the short horizon specs are realizable...&#39;</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">shprob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shprobs</span><span class="p">):</span>
                <span class="n">shprob</span><span class="o">.</span><span class="n">setLocalPhi</span><span class="p">(</span><span class="n">Phi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__Phi</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="n">realizable</span> <span class="o">=</span> <span class="n">shprob</span><span class="o">.</span><span class="n">checkRealizability</span><span class="p">(</span><span class="n">heap_size</span><span class="o">=</span><span class="n">heap_size</span><span class="p">,</span> <span class="n">pick_sys_init</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> \
                                                           <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">realizable</span><span class="p">):</span>
                    <span class="n">printInfo</span><span class="p">(</span><span class="s">&#39;shprob[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;] is not realizable&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>



<span class="c">###################################################################</span>

<span class="c"># Test case</span>
<span class="c">#  * 1: load from rhtlp file</span>
<span class="c">#  * 2: with dynamics, start from continuous dynamics</span>
<span class="c">#  * 3: with dynamics, start from discretized continuous dynamics</span>
<span class="c">#  * 4: no dynamics, start from continuous dynamics</span>
<span class="c">#  * 5: no dynamics, start from discretized continuous dynamics</span></div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">polytope_computations</span> <span class="kn">import</span> <span class="n">Polytope</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Testing createProb&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s">&#39;2&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s">&#39;3&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s">&#39;4&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">and</span> \
            <span class="ow">not</span> <span class="s">&#39;5&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="s">&#39;examples&#39;</span><span class="p">,</span> \
                                <span class="s">&#39;example.rhtlp&#39;</span><span class="p">)</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">SynthesisProb</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="nb">file</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">env_vars</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;park&#39;</span> <span class="p">:</span> <span class="s">&#39;boolean&#39;</span><span class="p">,</span> <span class="s">&#39;cellID&#39;</span> <span class="p">:</span> <span class="s">&#39;{0,...,3,4,5}&#39;</span><span class="p">}</span>
        <span class="n">sys_disc_vars</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;gear&#39;</span> <span class="p">:</span> <span class="s">&#39;{-1...1}&#39;</span><span class="p">}</span>
        <span class="n">disc_props</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Park&#39;</span> <span class="p">:</span> <span class="s">&#39;park&#39;</span><span class="p">,</span> \
                          <span class="s">&#39;X0d&#39;</span> <span class="p">:</span> <span class="s">&#39;cellID=0&#39;</span><span class="p">,</span> \
                          <span class="s">&#39;X1d&#39;</span> <span class="p">:</span> <span class="s">&#39;cellID=1&#39;</span><span class="p">,</span> \
                          <span class="s">&#39;X2d&#39;</span> <span class="p">:</span> <span class="s">&#39;cellID=2&#39;</span><span class="p">,</span> \
                          <span class="s">&#39;X3d&#39;</span> <span class="p">:</span> <span class="s">&#39;cellID=3&#39;</span><span class="p">,</span> \
                          <span class="s">&#39;X4d&#39;</span> <span class="p">:</span> <span class="s">&#39;cellID=4&#39;</span><span class="p">,</span> \
                          <span class="s">&#39;X5d&#39;</span> <span class="p">:</span> <span class="s">&#39;gear = 1&#39;</span><span class="p">}</span>
        <span class="n">assumption</span> <span class="o">=</span> <span class="s">&#39;[]&lt;&gt;(!park) &amp; []&lt;&gt;(!X4d)&#39;</span>
        <span class="n">guarantee</span> <span class="o">=</span> <span class="s">&#39;[]&lt;&gt;(X4d -&gt; (X4 | X5)) &amp; []&lt;&gt;X1 &amp; [](Park -&gt; (X0 | X2 | X5))&#39;</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">GRSpec</span><span class="p">()</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">env_prog</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;!park&#39;</span><span class="p">,</span> <span class="s">&#39;!X4d&#39;</span><span class="p">]</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">sys_prog</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;X4d -&gt; (X4 | X5)&#39;</span><span class="p">,</span> <span class="s">&#39;X1&#39;</span><span class="p">]</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">sys_safety</span> <span class="o">=</span> <span class="s">&#39;Park -&gt; (X0 | X2 | X5)&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;4&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="s">&#39;5&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span> <span class="c"># For spec with no dynamics</span>
            <span class="n">spec</span><span class="o">.</span><span class="n">sys_prog</span> <span class="o">=</span> <span class="s">&#39;[]&lt;&gt;(X0d -&gt; X5d)&#39;</span>  
            <span class="n">spec</span><span class="o">.</span><span class="n">sys_init</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">spec</span><span class="o">.</span><span class="n">sys_safety</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="s">&#39;4&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
                <span class="n">prob</span> <span class="o">=</span> <span class="n">SynthesisProb</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                         <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                         <span class="n">sys_cont_vars</span><span class="o">=</span><span class="p">[],</span> <span class="n">cont_state_space</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> \
                                         <span class="n">cont_props</span><span class="o">=</span><span class="p">{},</span> <span class="n">sys_dyn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">disc_dynamics</span><span class="o">=</span><span class="n">PropPreservingPartition</span><span class="p">()</span>
                <span class="n">prob</span> <span class="o">=</span> <span class="n">SynthesisProb</span><span class="p">()</span>
                <span class="n">prob</span><span class="o">.</span><span class="n">createProbFromDiscDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> \
                                                    <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                                    <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                                    <span class="n">disc_dynamics</span><span class="o">=</span><span class="n">PropPreservingPartition</span><span class="p">(),</span> \
                                                    <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cont_state_space</span> <span class="o">=</span> <span class="n">Polytope</span><span class="p">(</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]),</span> \
                                            <span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.</span><span class="p">]]))</span>
            <span class="n">cont_props</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">cont_props</span><span class="p">[</span><span class="s">&#39;X0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Polytope</span><span class="p">(</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]),</span> \
                                            <span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">]]))</span>
            <span class="n">cont_props</span><span class="p">[</span><span class="s">&#39;X1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Polytope</span><span class="p">(</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]),</span> \
                                            <span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">]]))</span>
            <span class="n">cont_props</span><span class="p">[</span><span class="s">&#39;X2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Polytope</span><span class="p">(</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]),</span> \
                                            <span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">2.</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">]]))</span>
            <span class="n">cont_props</span><span class="p">[</span><span class="s">&#39;X3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Polytope</span><span class="p">(</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]),</span> \
                                            <span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.</span><span class="p">]]))</span>
            <span class="n">cont_props</span><span class="p">[</span><span class="s">&#39;X4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Polytope</span><span class="p">(</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]),</span> \
                                            <span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.</span><span class="p">]]))</span>
            <span class="n">cont_props</span><span class="p">[</span><span class="s">&#39;X5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Polytope</span><span class="p">(</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]),</span> \
                                            <span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">2.</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.</span><span class="p">]]))</span>

            <span class="k">if</span> <span class="p">(</span><span class="s">&#39;2&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
                <span class="n">prob</span> <span class="o">=</span> <span class="n">SynthesisProb</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                         <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                         <span class="n">sys_cont_vars</span><span class="o">=</span><span class="p">[],</span> <span class="n">cont_state_space</span><span class="o">=</span><span class="n">cont_state_space</span><span class="p">,</span> \
                                         <span class="n">cont_props</span><span class="o">=</span><span class="n">cont_props</span><span class="p">,</span> <span class="n">sys_dyn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">disc_dynamics</span> <span class="o">=</span> <span class="n">PropPreservingPartition</span><span class="p">()</span>
                <span class="n">region0</span> <span class="o">=</span> <span class="n">Region</span><span class="p">([</span><span class="n">cont_props</span><span class="p">[</span><span class="s">&#39;X0&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">region1</span> <span class="o">=</span> <span class="n">Region</span><span class="p">([</span><span class="n">cont_props</span><span class="p">[</span><span class="s">&#39;X1&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">region2</span> <span class="o">=</span> <span class="n">Region</span><span class="p">([</span><span class="n">cont_props</span><span class="p">[</span><span class="s">&#39;X2&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">region3</span> <span class="o">=</span> <span class="n">Region</span><span class="p">([</span><span class="n">cont_props</span><span class="p">[</span><span class="s">&#39;X3&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">region4</span> <span class="o">=</span> <span class="n">Region</span><span class="p">([</span><span class="n">cont_props</span><span class="p">[</span><span class="s">&#39;X4&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">region5</span> <span class="o">=</span> <span class="n">Region</span><span class="p">([</span><span class="n">cont_props</span><span class="p">[</span><span class="s">&#39;X5&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_region</span> <span class="o">=</span> <span class="p">[</span><span class="n">region0</span><span class="p">,</span> <span class="n">region1</span><span class="p">,</span> <span class="n">region2</span><span class="p">,</span> <span class="n">region3</span><span class="p">,</span> <span class="n">region4</span><span class="p">,</span> <span class="n">region5</span><span class="p">]</span>
                <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">num_regions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_region</span><span class="p">)</span>
                <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">trans</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> \
                                     <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> \
                                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> \
                                     <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> \
                                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> \
                                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
                <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_prop_symbol</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;X0&#39;</span><span class="p">,</span> <span class="s">&#39;X1&#39;</span><span class="p">,</span> <span class="s">&#39;X2&#39;</span><span class="p">,</span> <span class="s">&#39;X3&#39;</span><span class="p">,</span> <span class="s">&#39;X4&#39;</span><span class="p">,</span> <span class="s">&#39;X5&#39;</span><span class="p">]</span>
                <span class="n">disc_dynamics</span><span class="o">.</span><span class="n">num_prop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">disc_dynamics</span><span class="o">.</span><span class="n">list_prop_symbol</span><span class="p">)</span>
                <span class="n">prob</span> <span class="o">=</span> <span class="n">SynthesisProb</span><span class="p">()</span>
                <span class="n">prob</span><span class="o">.</span><span class="n">createProbFromDiscDynamics</span><span class="p">(</span><span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> \
                                                    <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                                    <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                                    <span class="n">disc_dynamics</span><span class="o">=</span><span class="n">disc_dynamics</span><span class="p">,</span> \
                                                    <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;DONE&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;================================</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="c">####################################</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Testing checkRealizability&#39;</span><span class="p">)</span>
    <span class="n">realizable</span> <span class="o">=</span> <span class="n">prob</span><span class="o">.</span><span class="n">checkRealizability</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">realizable</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;DONE&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;================================</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="c">####################################</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Testing synthesizePlannerAut&#39;</span><span class="p">)</span>
    <span class="n">aut</span> <span class="o">=</span> <span class="n">prob</span><span class="o">.</span><span class="n">synthesizePlannerAut</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;DONE&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;================================</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="c">####################################</span>

    <span class="k">if</span> <span class="p">(</span><span class="s">&#39;2&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="s">&#39;3&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Testing ShortHorizonProb&#39;</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">sys_prog</span> <span class="o">=</span> <span class="s">&#39;X1&#39;</span>
        <span class="n">rhtlpprob</span> <span class="o">=</span> <span class="n">RHTLPProb</span><span class="p">(</span><span class="n">shprobs</span><span class="o">=</span><span class="p">[],</span> <span class="n">discretize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> \
                                  <span class="n">env_vars</span><span class="o">=</span><span class="n">prob</span><span class="o">.</span><span class="n">getEnvVars</span><span class="p">(),</span> <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                  <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                  <span class="n">disc_dynamics</span><span class="o">=</span><span class="n">prob</span><span class="o">.</span><span class="n">getDiscretizedDynamics</span><span class="p">(),</span> \
                                  <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">grspec</span> <span class="o">=</span> <span class="n">GRSpec</span><span class="p">()</span>
        <span class="n">grspec</span><span class="o">.</span><span class="n">env_prog</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;!park&#39;</span><span class="p">,</span> <span class="s">&#39;!X4d&#39;</span><span class="p">]</span>
        <span class="n">grspec</span><span class="o">.</span><span class="n">sys_prog</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;X4d -&gt; (X4 | X5)&#39;</span><span class="p">,</span> <span class="s">&#39;X1&#39;</span><span class="p">]</span>
        <span class="n">grspec</span><span class="o">.</span><span class="n">sys_safety</span><span class="o">=</span><span class="s">&#39;Park -&gt; (X0 | X2 | X5)&#39;</span>
        <span class="n">shprob</span> <span class="o">=</span> <span class="n">ShortHorizonProb</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">FW</span><span class="o">=</span><span class="p">[],</span> <span class="n">Phi</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                                      <span class="n">global_prob</span><span class="o">=</span><span class="n">rhtlpprob</span><span class="p">,</span> \
                                      <span class="n">env_vars</span><span class="o">=</span><span class="n">prob</span><span class="o">.</span><span class="n">getEnvVars</span><span class="p">(),</span> \
                                      <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                      <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                      <span class="n">disc_dynamics</span><span class="o">=</span><span class="n">prob</span><span class="o">.</span><span class="n">getDiscretizedDynamics</span><span class="p">(),</span> \
                                      <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">shprob</span><span class="o">.</span><span class="n">setW</span><span class="p">(</span><span class="s">&#39;(X2 -&gt; X3 | X1 -&gt; X4) &amp; X2d&#39;</span><span class="p">)</span>
        <span class="n">shprob2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">shprob</span><span class="p">)</span>
        <span class="n">shprob2</span><span class="o">.</span><span class="n">setW</span><span class="p">(</span><span class="s">&#39;X1&#39;</span><span class="p">)</span>
        <span class="n">shprob</span><span class="o">.</span><span class="n">setFW</span><span class="p">([</span><span class="n">shprob2</span><span class="p">])</span>
        <span class="n">shprob2</span><span class="o">.</span><span class="n">setFW</span><span class="p">([</span><span class="n">shprob</span><span class="p">])</span>
        <span class="n">shprob</span><span class="o">.</span><span class="n">setLocalPhi</span><span class="p">(</span><span class="s">&#39;X2 | X4&#39;</span><span class="p">)</span>
        <span class="n">shprob</span><span class="o">.</span><span class="n">updateLocalSpec</span><span class="p">()</span>
        <span class="n">shprob</span><span class="o">.</span><span class="n">computeLocalPhi</span><span class="p">()</span>
        <span class="n">shprob2</span><span class="o">.</span><span class="n">updateLocalSpec</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">shprob</span><span class="o">.</span><span class="n">getLocalPhi</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;DONE&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;================================</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Testing RHTLPProb&#39;</span><span class="p">)</span>
        <span class="n">rhtlpprob</span><span class="o">.</span><span class="n">addSHProb</span><span class="p">(</span><span class="n">shprob</span><span class="p">)</span>
        <span class="n">rhtlpprob</span><span class="o">.</span><span class="n">addSHProb</span><span class="p">(</span><span class="n">shprob2</span><span class="p">)</span>
<span class="c">#         spec.sys_prog = &#39;X1&#39;</span>
<span class="c">#         rhtlpprob = RHTLPProb(shprobs=[shprob, shprob2], discretize=False, \</span>
<span class="c">#                                   env_vars=prob.getEnvVars(), sys_disc_vars=sys_disc_vars, \</span>
<span class="c">#                                   disc_props=disc_props, \</span>
<span class="c">#                                   disc_dynamics=prob.getDiscretizedDynamics(), \</span>
<span class="c">#                                   spec=spec, verbose=3)</span>
        <span class="n">rhtlpprob</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">checkcovering</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">checkpartial_order</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">checktautology</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> \
                     <span class="n">checkrealizable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;DONE&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;================================</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="p">(</span><span class="s">&#39;4&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="s">&#39;5&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Testing ShortHorizonProb&#39;</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">sys_prog</span> <span class="o">=</span> <span class="s">&#39;X1&#39;</span>
        <span class="n">rhtlpprob</span> <span class="o">=</span> <span class="n">RHTLPProb</span><span class="p">(</span><span class="n">shprobs</span><span class="o">=</span><span class="p">[],</span> <span class="n">discretize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> \
                                  <span class="n">env_vars</span><span class="o">=</span><span class="n">prob</span><span class="o">.</span><span class="n">getEnvVars</span><span class="p">(),</span> <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                  <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                  <span class="n">disc_dynamics</span><span class="o">=</span><span class="n">PropPreservingPartition</span><span class="p">(),</span> \
                                  <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">W</span><span class="o">=</span><span class="s">&#39;X2d&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;4&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
            <span class="n">shprob</span> <span class="o">=</span> <span class="n">ShortHorizonProb</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="p">,</span> <span class="n">FW</span><span class="o">=</span><span class="p">[],</span> <span class="n">Phi</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> \
                                          <span class="n">global_prob</span><span class="o">=</span><span class="n">rhtlpprob</span><span class="p">,</span> \
                                          <span class="n">env_vars</span><span class="o">=</span><span class="n">prob</span><span class="o">.</span><span class="n">getEnvVars</span><span class="p">(),</span> \
                                          <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                          <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                          <span class="n">sys_cont_vars</span><span class="o">=</span><span class="p">[],</span> <span class="n">cont_state_space</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> \
                                          <span class="n">cont_props</span><span class="o">=</span><span class="p">{},</span> <span class="n">sys_dyn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shprob</span> <span class="o">=</span> <span class="n">ShortHorizonProb</span><span class="p">(</span><span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="p">,</span> <span class="n">FW</span><span class="o">=</span><span class="p">[],</span> <span class="n">Phi</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> \
                                          <span class="n">global_prob</span><span class="o">=</span><span class="n">rhtlpprob</span><span class="p">,</span> \
                                          <span class="n">env_vars</span><span class="o">=</span><span class="n">prob</span><span class="o">.</span><span class="n">getEnvVars</span><span class="p">(),</span> \
                                          <span class="n">sys_disc_vars</span><span class="o">=</span><span class="n">sys_disc_vars</span><span class="p">,</span> \
                                          <span class="n">disc_props</span><span class="o">=</span><span class="n">disc_props</span><span class="p">,</span> \
                                          <span class="n">disc_dynamics</span><span class="o">=</span><span class="n">PropPreservingPartition</span><span class="p">(),</span> \
                                          <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            
        <span class="n">shprob2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">shprob</span><span class="p">)</span>
        <span class="n">shprob2</span><span class="o">.</span><span class="n">setW</span><span class="p">(</span><span class="s">&#39;X1d&#39;</span><span class="p">)</span>
        <span class="n">shprob</span><span class="o">.</span><span class="n">setFW</span><span class="p">([</span><span class="n">shprob2</span><span class="p">])</span>
        <span class="n">shprob2</span><span class="o">.</span><span class="n">setFW</span><span class="p">([</span><span class="n">shprob</span><span class="p">])</span>
        <span class="n">shprob</span><span class="o">.</span><span class="n">computeLocalPhi</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">shprob</span><span class="o">.</span><span class="n">getLocalPhi</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;DONE&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;================================</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Testing RHTLPProb&#39;</span><span class="p">)</span>
        <span class="n">rhtlpprob</span><span class="o">.</span><span class="n">addSHProb</span><span class="p">(</span><span class="n">shprob</span><span class="p">)</span>
        <span class="n">rhtlpprob</span><span class="o">.</span><span class="n">addSHProb</span><span class="p">(</span><span class="n">shprob2</span><span class="p">)</span>
<span class="c">#         spec.sys_prog = &#39;X1&#39;</span>
<span class="c">#         rhtlpprob = RHTLPProb(shprobs=[shprob, shprob2], discretize=False, \</span>
<span class="c">#                                   env_vars=prob.getEnvVars(), sys_disc_vars=sys_disc_vars, \</span>
<span class="c">#                                   disc_props=disc_props, \</span>
<span class="c">#                                   disc_dynamics=PropPreservingPartition(), \</span>
<span class="c">#                                   spec=spec, verbose=3)</span>
        <span class="n">rhtlpprob</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">checkcovering</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">checkpartial_order</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">checktautology</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> \
                     <span class="n">checkrealizable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;DONE&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;================================</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">rhtlp v0.1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Richard Murray, Necmiye Ozay, Ufuk Topcu, Nok Wongpiromsarn, Mumu Xu.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.1.
    </div>
  </body>
</html>